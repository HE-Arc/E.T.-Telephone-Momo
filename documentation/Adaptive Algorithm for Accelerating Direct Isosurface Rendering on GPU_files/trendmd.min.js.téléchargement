!function(){return function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){return i(t[s][1][e]||e)},l,l.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}}()({1:[function(e,t,r){t.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}},{}],2:[function(e,t,r){t.exports=function(e){if(Array.isArray(e))return e}},{}],3:[function(e,t,r){function n(e,t,r,n,i,o,s){try{var a=e[o](s),u=a.value}catch(e){return void r(e)}a.done?t(u):Promise.resolve(u).then(n,i)}t.exports=function(e){return function(){var t=this,r=arguments;return new Promise(function(i,o){var s=e.apply(t,r);function a(e){n(s,i,o,a,u,"next",e)}function u(e){n(s,i,o,a,u,"throw",e)}a(void 0)})}}},{}],4:[function(e,t,r){t.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],5:[function(e,t,r){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}t.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},{}],6:[function(e,t,r){t.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},{}],7:[function(e,t,r){t.exports=function(e){return e&&e.__esModule?e:{default:e}}},{}],8:[function(e,t,r){t.exports=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return r}}},{}],9:[function(e,t,r){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},{}],10:[function(e,t,r){var n=e("./arrayWithHoles"),i=e("./iterableToArrayLimit"),o=e("./unsupportedIterableToArray"),s=e("./nonIterableRest");t.exports=function(e,t){return n(e)||i(e,t)||o(e,t)||s()}},{"./arrayWithHoles":2,"./iterableToArrayLimit":8,"./nonIterableRest":9,"./unsupportedIterableToArray":11}],11:[function(e,t,r){var n=e("./arrayLikeToArray");t.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}},{"./arrayLikeToArray":1}],12:[function(e,t,r){t.exports=e("regenerator-runtime")},{"regenerator-runtime":20}],13:[function(e,t,r){t.exports=function(e){var t=this;e=e||{},t.type=e.type||"cache-module",t.verbose=e.verbose||!1,t.defaultExpiration=e.defaultExpiration||900,t.readOnly=e.readOnly||!1,t.checkOnPreviousEmpty="boolean"!=typeof e.checkOnPreviousEmpty||e.checkOnPreviousEmpty,t.backgroundRefreshIntervalCheck="boolean"!=typeof e.backgroundRefreshIntervalCheck||e.backgroundRefreshIntervalCheck,t.backgroundRefreshInterval=e.backgroundRefreshInterval||6e4,t.backgroundRefreshMinTtl=e.backgroundRefreshMinTtl||7e4;var r,n,i=null,o=e.storageMock||!1,s=!1,a="undefined"!=typeof window,u={db:{},expirations:{},refreshKeys:{}};function c(){if(a&&i||o){var e=u;try{e=JSON.stringify(e),i.setItem(r,e)}catch(e){}}}function l(e,t){if(e)throw new Error(t)}function h(){Object.keys(u.refreshKeys).forEach(function(e){var t=u.refreshKeys[e];t.expiration-Date.now()<this.backgroundRefreshMinTtl&&t.refresh(e,function(e,t,r,n){r||this.set(e,n,t.lifeSpan/1e3,t.refresh,function(){})}.bind(this,e,t))},t)}function p(e,r,n){(t.verbose||e)&&(n?console.log(t.type+": "+r,n):console.log(t.type+r))}!function(){if(a||o){if(o)i=o,r="cache-module-storage-mock";else{var n="local"===e.storage||"session"===e.storage?e.storage:null;i=!(!n||void 0===typeof Storage)&&window[n+"Storage"],r=n?t.type+"-"+n+"-storage":null}if(i){var s=i.getItem(r);try{u=JSON.parse(s)||u}catch(e){}}else n&&p(!0,"Browser storage is not supported by this browser. Defaulting to an in-memory cache.")}}(),p(!1,"Cache-module client created with the following defaults:",{type:t.type,defaultExpiration:t.defaultExpiration,verbose:t.verbose,readOnly:t.readOnly}),t.get=function(e,t){l(arguments.length<2,"ARGUMENT_EXCEPTION: .get() requires 2 arguments."),p(!1,"get() called:",{key:e});try{var r=Date.now();if(u.expirations[e]>r){var n=u.db[e];"object"==typeof n&&(i=n,n=JSON.parse(JSON.stringify(i))),t(null,n)}else!function(e){delete u.db[e],delete u.expirations[e],c()}(e),t(null,null)}catch(e){t({name:"GetException",message:e},null)}var i},t.mget=function(e,r,n){l(arguments.length<2,"ARGUMENT_EXCEPTION: .mget() requires 2 arguments."),p(!1,".mget() called:",{keys:e});for(var i={},o=0;o<e.length;o++){var s=e[o];t.get(s,function(e,t){null!==t&&(i[s]=t)})}r(null,i,n)},t.set=function(){l(arguments.length<2,"ARGUMENT_EXCEPTION: .set() requires at least 2 arguments.");var e=arguments[0],r=arguments[1],i=arguments[2]||null,o=5==arguments.length?arguments[3]:null,a=5==arguments.length?arguments[4]:arguments[3];if(p(!1,".set() called:",{key:e,value:r}),!t.readOnly)try{var d=(i=i?1e3*i:1e3*t.defaultExpiration)+Date.now();u.expirations[e]=d,u.db[e]=r,a&&a(),o&&(u.refreshKeys[e]={expiration:d,lifeSpan:i,refresh:o},function(){if(!s){if(s=!0,t.backgroundRefreshIntervalCheck&&t.backgroundRefreshInterval>t.backgroundRefreshMinTtl)throw new Error("BACKGROUND_REFRESH_INTERVAL_EXCEPTION: backgroundRefreshInterval cannot be greater than backgroundRefreshMinTtl.");n=setInterval(h,t.backgroundRefreshInterval)}}()),c()}catch(e){p(!0,".set() failed for cache of type "+t.type,{name:"CacheModuleSetException",message:e})}},t.mset=function(e,r,n){for(var i in l(arguments.length<1,"ARGUMENT_EXCEPTION: .mset() requires at least 1 argument."),p(!1,".mset() called:",{data:e}),e)if(e.hasOwnProperty(i)){var o=r||t.defaultExpiration,s=e[i];"object"==typeof s&&s.cacheValue&&(o=s.expiration||o,s=s.cacheValue),t.set(i,s,o)}n&&n()},t.del=function(e,t){if(l(arguments.length<1,"ARGUMENT_EXCEPTION: .del() requires at least 1 argument."),p(!1,".del() called:",{keys:e}),"object"==typeof e){for(var r=0;r<e.length;r++){var n=e[r];delete u.db[n],delete u.expirations[n],delete u.refreshKeys[n]}t&&t(null,e.length)}else delete u.db[e],delete u.expirations[e],delete u.refreshKeys[e],t&&t(null,1);c()},t.flush=function(e){p(!1,".flush() called"),u.db={},u.expirations={},u.refreshKeys={},e&&e(),c(),n&&clearInterval(n),s=!1}}},{}],14:[function(e,t,r){function n(e){if(e)return function(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}(e)}void 0!==t&&(t.exports=n),n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){n=0;for(var i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t)}return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],15:[function(e,t,r){!function(e,r){void 0!==t?t.exports=r():"function"==typeof define&&"object"==typeof define.amd?define(r):this.domready=r()}(0,function(e){var t,r=[],n=document,i=n.documentElement,o=i.doScroll,s=(o?/^loaded|^c/:/^loaded|c/).test(n.readyState);function a(e){for(s=1;e=r.shift();)e()}return n.addEventListener&&n.addEventListener("DOMContentLoaded",t=function(){n.removeEventListener("DOMContentLoaded",t,!1),a()},!1),o&&n.attachEvent("onreadystatechange",t=function(){/^c/.test(n.readyState)&&(n.detachEvent("onreadystatechange",t),a())}),e=o?function(t){self!=top?s?t():r.push(t):function(){try{i.doScroll("left")}catch(r){return setTimeout(function(){e(t)},50)}t()}()}:function(e){s?e():r.push(e)}})},{}],16:[function(e,t,r){(function(e){(function(){!function(n){var i="object"==typeof r&&r&&!r.nodeType&&r,o="object"==typeof t&&t&&!t.nodeType&&t,s="object"==typeof e&&e;s.global!==s&&s.window!==s&&s.self!==s||(n=s);var a,u,c=2147483647,l=36,h=1,p=26,d=38,f=700,m=72,g=128,y="-",b=/^xn--/,v=/[^\x20-\x7E]/,w=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},k=l-h,C=Math.floor,O=String.fromCharCode;function x(e){throw new RangeError(_[e])}function E(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function P(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+E((e=e.replace(w,".")).split("."),t).join(".")}function j(e){for(var t,r,n=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function T(e){return E(e,function(e){var t="";return e>65535&&(t+=O((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=O(e)}).join("")}function S(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function I(e,t,r){var n=0;for(e=r?C(e/f):e>>1,e+=C(e/t);e>k*p>>1;n+=l)e=C(e/k);return C(n+(k+1)*e/(e+d))}function R(e){var t,r,n,i,o,s,a,u,d,f,b,v=[],w=e.length,_=0,k=g,O=m;for((r=e.lastIndexOf(y))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&x("not-basic"),v.push(e.charCodeAt(n));for(i=r>0?r+1:0;i<w;){for(o=_,s=1,a=l;i>=w&&x("invalid-input"),((u=(b=e.charCodeAt(i++))-48<10?b-22:b-65<26?b-65:b-97<26?b-97:l)>=l||u>C((c-_)/s))&&x("overflow"),_+=u*s,!(u<(d=a<=O?h:a>=O+p?p:a-O));a+=l)s>C(c/(f=l-d))&&x("overflow"),s*=f;O=I(_-o,t=v.length+1,0==o),C(_/t)>c-k&&x("overflow"),k+=C(_/t),_%=t,v.splice(_++,0,k)}return T(v)}function A(e){var t,r,n,i,o,s,a,u,d,f,b,v,w,_,k,E=[];for(v=(e=j(e)).length,t=g,r=0,o=m,s=0;s<v;++s)(b=e[s])<128&&E.push(O(b));for(n=i=E.length,i&&E.push(y);n<v;){for(a=c,s=0;s<v;++s)(b=e[s])>=t&&b<a&&(a=b);for(a-t>C((c-r)/(w=n+1))&&x("overflow"),r+=(a-t)*w,t=a,s=0;s<v;++s)if((b=e[s])<t&&++r>c&&x("overflow"),b==t){for(u=r,d=l;!(u<(f=d<=o?h:d>=o+p?p:d-o));d+=l)k=u-f,_=l-f,E.push(O(S(f+k%_,0))),u=C(k/_);E.push(O(S(u,0))),o=I(r,w,n==i),r=0,++n}++r,++t}return E.join("")}if(a={version:"1.4.1",ucs2:{decode:j,encode:T},decode:R,encode:A,toASCII:function(e){return P(e,function(e){return v.test(e)?"xn--"+A(e):e})},toUnicode:function(e){return P(e,function(e){return b.test(e)?R(e.slice(4).toLowerCase()):e})}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return a});else if(i&&o)if(t.exports==i)o.exports=a;else for(u in a)a.hasOwnProperty(u)&&(i[u]=a[u]);else n.punycode=a}(this)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],17:[function(e,t,r){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,r,o){t=t||"&",r=r||"=";var s={};if("string"!=typeof e||0===e.length)return s;var a=/\+/g;e=e.split(t);var u=1e3;o&&"number"==typeof o.maxKeys&&(u=o.maxKeys);var c=e.length;u>0&&c>u&&(c=u);for(var l=0;l<c;++l){var h,p,d,f,m=e[l].replace(a,"%20"),g=m.indexOf(r);g>=0?(h=m.substr(0,g),p=m.substr(g+1)):(h=m,p=""),d=decodeURIComponent(h),f=decodeURIComponent(p),n(s,d)?i(s[d])?s[d].push(f):s[d]=[s[d],f]:s[d]=f}return s};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],18:[function(e,t,r){"use strict";var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,r,a){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?o(s(e),function(s){var a=encodeURIComponent(n(s))+r;return i(e[s])?o(e[s],function(e){return a+encodeURIComponent(n(e))}).join(t):a+encodeURIComponent(n(e[s]))}).join(t):a?encodeURIComponent(n(a))+r+encodeURIComponent(n(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var s=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},{}],19:[function(e,t,r){"use strict";r.decode=r.parse=e("./decode"),r.encode=r.stringify=e("./encode")},{"./decode":17,"./encode":18}],20:[function(e,t,r){var n=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i=t&&t.prototype instanceof g?t:g,o=Object.create(i.prototype),s=new j(n||[]);return o._invoke=function(e,t,r){var n=h;return function(i,o){if(n===d)throw new Error("Generator is already running");if(n===f){if("throw"===i)throw o;return S()}for(r.method=i,r.arg=o;;){var s=r.delegate;if(s){var a=x(s,r);if(a){if(a===m)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===h)throw n=f,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=d;var u=l(e,t,r);if("normal"===u.type){if(n=r.done?f:p,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=f,r.method="throw",r.arg=u.arg)}}}(e,r,s),o}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var h="suspendedStart",p="suspendedYield",d="executing",f="completed",m={};function g(){}function y(){}function b(){}var v={};v[o]=function(){return this};var w=Object.getPrototypeOf,_=w&&w(w(T([])));_&&_!==r&&n.call(_,o)&&(v=_);var k=b.prototype=g.prototype=Object.create(v);function C(e){["next","throw","return"].forEach(function(t){u(e,t,function(e){return this._invoke(t,e)})})}function O(e,t){var r;this._invoke=function(i,o){function s(){return new t(function(r,s){!function r(i,o,s,a){var u=l(e[i],e,o);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==typeof h&&n.call(h,"__await")?t.resolve(h.__await).then(function(e){r("next",e,s,a)},function(e){r("throw",e,s,a)}):t.resolve(h).then(function(e){c.value=e,s(c)},function(e){return r("throw",e,s,a)})}a(u.arg)}(i,o,r,s)})}return r=r?r.then(s,s):s()}}function x(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method))return m;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=l(n,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var o=i.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function T(e){if(e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}return{next:S}}function S(){return{value:t,done:!0}}return y.prototype=k.constructor=b,b.constructor=y,y.displayName=u(b,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,a,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},C(O.prototype),O.prototype[s]=function(){return this},e.AsyncIterator=O,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var s=new O(c(t,r,n,i),o);return e.isGeneratorFunction(r)?s:s.next().then(function(e){return e.done?e.value:s.next()})},C(k),u(k,a,"Generator"),k[o]=function(){return this},k.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=T,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var u=n.call(s,"catchLoc"),c=n.call(s,"finallyLoc");if(u&&c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:T(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}("object"==typeof t?t.exports:{});try{regeneratorRuntime=n}catch(e){Function("r","regeneratorRuntime = r")(n)}},{}],21:[function(e,t,r){var n=e("./utils");t.exports=function(e,t){var r=this,i=["GET","HEAD","POST","PUT","PATCH","DELETE"],o=["GET","HEAD"];return this.cache=e,this.defaults=t||{},function(t){var s=n.resetProps(r.defaults);t.doQuery=function(e){return s.doQuery=e,t},t.pruneQuery=function(e){return s.pruneQuery=e,t},t.pruneHeader=function(e){return s.pruneHeader=e,t},t.prune=function(e){return s.prune=e,t},t.responseProp=function(e){return s.responseProp=e,t},t.expiration=function(e){return s.expiration=e,t},t.cacheWhenEmpty=function(e){return s.cacheWhenEmpty=e,t},t.forceUpdate=function(e){return s.forceUpdate="boolean"!=typeof e||e,t};var a=t.end;return t.end=function(r){if(t.scRedirectsList=t.scRedirectsList||[],t.scRedirectsList=t.scRedirectsList.concat(t._redirectList),~i.indexOf(t.method.toUpperCase())){var u=t,c=n.keygen(t,s);~o.indexOf(t.method.toUpperCase())?e.get(c,function(i,o){if(i||!o||s.forceUpdate){if(!s.doQuery)return n.callbackExecutor(r,null,null,c);a.call(t,function(t,i){if(t)return n.callbackExecutor(r,t,i,c);if(!t&&i){if(i.redirects=u.scRedirectsList,i=s.prune?s.prune(i,n.gutResponse):s.responseProp?i[s.responseProp]||null:n.gutResponse(i),n.isEmpty(i)&&!s.cacheWhenEmpty)return n.callbackExecutor(r,t,i,c);e.set(c,i,s.expiration,function(){return n.callbackExecutor(r,t,i,c)})}})}else n.callbackExecutor(r,i,o,c)}):a.call(t,function(t,i){if(t)return n.callbackExecutor(r,t,i,c);if(!t&&i){var o=c.replace('"method":"'+u.method+'"','"method":"GET"'),s=c.replace('"method":"'+u.method+'"','"method":"HEAD"');e.del([o,s],function(){n.callbackExecutor(r,t,i,c)})}})}else a.call(t,function(e,t){return n.callbackExecutor(r,e,t,void 0)})},t}}},{"./utils":22}],22:[function(e,t,r){t.exports={keygen:function(e,t){var r=null,n=null,i=this.getQueryParams(e),o=this.getHeaderOptions(e);return(t.pruneQuery||t.pruneHeader)&&(r=t.pruneQuery?this.pruneObj(this.cloneObject(i),t.pruneQuery):i,n=t.pruneHeader?this.pruneObj(this.cloneObject(o),t.pruneHeader,!0):o),JSON.stringify({method:e.method,uri:e.url,params:r||i||null,options:n||o||null})},getQueryParams:function(e){return e&&e.qs&&!this.isEmpty(e.qs)?e.qs:e&&e.qsRaw?this.arrayToObj(e.qsRaw):e&&e.req?this.stringToObj(e.req.path):e&&e._query?this.stringToObj(e._query.join("&")):null},getHeaderOptions:function(e){return e&&e._header?this.pruneObj(e._header,["User-Agent","user-agent"]):e&&e.req&&e.req._headers?this.pruneObj(e.req._headers,["User-Agent","user-agent"]):e&&e.header?this.pruneObj(e.header,["User-Agent","user-agent"]):null},arrayToObj:function(e){if(e&&e.length){for(var t={},r=0;r<e.length;r++)for(var n=e[r].split("&"),i=0;i<n.length;i++){var o=n[i].split("=");t[o[0]]=o[1]}return t}return null},stringToObj:function(e){if(e){var t={};if(~e.indexOf("?")){var r=e.split("?");e=r[1]}for(var n=e.split("&"),i=0;i<n.length;i++){var o=n[i].split("=");t[o[0]]=o[1]}return t}return null},pruneObj:function(e,t,r){for(var n=0;n<t.length;n++){var i=t[n];r&&delete e[i.toLowerCase()],delete e[i]}return e},gutResponse:function(e){var t={};return t.body=e.body,t.text=e.text,t.headers=e.headers,t.statusCode=e.statusCode,t.status=e.status,t.ok=e.ok,t},isEmpty:function(e){return!1===e||null===e||"object"==typeof e&&0==Object.keys(e).length},cloneObject:function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},resetProps:function(e){return{doQuery:"boolean"!=typeof e.doQuery||e.doQuery,cacheWhenEmpty:"boolean"!=typeof e.cacheWhenEmpty||e.cacheWhenEmpty,prune:e.prune,pruneQuery:e.pruneQuery,pruneHeader:e.pruneHeader,responseProp:e.responseProp,expiration:e.expiration,forceUpdate:e.forceUpdate,preventDuplicateCalls:e.preventDuplicateCalls,backgroundRefresh:e.backgroundRefresh}},callbackExecutor:function(e,t,r,n){if(1===e.length)e(r);else{if(!(e.length>1))throw new Error("UnsupportedCallbackException: Your .end() callback must pass at least one argument.");e(t,r,n)}}}},{}],23:[function(e,t,r){function n(){this._defaults=[]}["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert"].forEach(function(e){n.prototype[e]=function(){return this._defaults.push({fn:e,arguments:arguments}),this}}),n.prototype._setDefaults=function(e){this._defaults.forEach(function(t){e[t.fn].apply(e,t.arguments)})},t.exports=n},{}],24:[function(e,t,r){var n;"undefined"!=typeof window?n=window:"undefined"!=typeof self?n=self:(console.warn("Using browser-only version of superagent in non-browser environment"),n=this);var i=e("component-emitter"),o=e("./request-base"),s=e("./is-object"),a=e("./response-base"),u=e("./agent-base");function c(){}var l=r=t.exports=function(e,t){return"function"==typeof t?new r.Request("GET",e).end(t):1==arguments.length?new r.Request("GET",e):new r.Request(e,t)};r.Request=y,l.getXHR=function(){if(!(!n.XMLHttpRequest||n.location&&"file:"==n.location.protocol&&n.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}throw Error("Browser-only version of superagent could not find XHR")};var h="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};function p(e){if(!s(e))return e;var t=[];for(var r in e)d(t,r,e[r]);return t.join("&")}function d(e,t,r){if(null!=r)if(Array.isArray(r))r.forEach(function(r){d(e,t,r)});else if(s(r))for(var n in r)d(e,t+"["+n+"]",r[n]);else e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));else null===r&&e.push(encodeURIComponent(t))}function f(e){for(var t,r,n={},i=e.split("&"),o=0,s=i.length;o<s;++o)-1==(r=(t=i[o]).indexOf("="))?n[decodeURIComponent(t)]="":n[decodeURIComponent(t.slice(0,r))]=decodeURIComponent(t.slice(r+1));return n}function m(e){return/[\/+]json($|[^-\w])/.test(e)}function g(e){this.req=e,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var t=this.xhr.status;1223===t&&(t=204),this._setStatusProperties(t),this.header=this.headers=function(e){for(var t,r,n,i,o=e.split(/\r?\n/),s={},a=0,u=o.length;a<u;++a)-1!==(t=(r=o[a]).indexOf(":"))&&(n=r.slice(0,t).toLowerCase(),i=h(r.slice(t+1)),s[n]=i);return s}(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&e._responseType?this.body=this.xhr.response:this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function y(e,t){var r=this;this._query=this._query||[],this.method=e,this.url=t,this.header={},this._header={},this.on("end",function(){var e,t=null,n=null;try{n=new g(r)}catch(e){return(t=new Error("Parser is unable to parse the response")).parse=!0,t.original=e,r.xhr?(t.rawResponse=void 0===r.xhr.responseType?r.xhr.responseText:r.xhr.response,t.status=r.xhr.status?r.xhr.status:null,t.statusCode=t.status):(t.rawResponse=null,t.status=null),r.callback(t)}r.emit("response",n);try{r._isResponseOK(n)||(e=new Error(n.statusText||"Unsuccessful HTTP response"))}catch(t){e=t}e?(e.original=t,e.response=n,e.status=n.status,r.callback(e,n)):r.callback(null,n)})}function b(e,t,r){var n=l("DELETE",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n}l.serializeObject=p,l.parseString=f,l.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},l.serialize={"application/x-www-form-urlencoded":p,"application/json":JSON.stringify},l.parse={"application/x-www-form-urlencoded":f,"application/json":JSON.parse},a(g.prototype),g.prototype._parseBody=function(e){var t=l.parse[this.type];return this.req._parser?this.req._parser(this,e):(!t&&m(this.type)&&(t=l.parse["application/json"]),t&&e&&(e.length||e instanceof Object)?t(e):null)},g.prototype.toError=function(){var e=this.req,t=e.method,r=e.url,n="cannot "+t+" "+r+" ("+this.status+")",i=new Error(n);return i.status=this.status,i.method=t,i.url=r,i},l.Response=g,i(y.prototype),o(y.prototype),y.prototype.type=function(e){return this.set("Content-Type",l.types[e]||e),this},y.prototype.accept=function(e){return this.set("Accept",l.types[e]||e),this},y.prototype.auth=function(e,t,r){1===arguments.length&&(t=""),"object"==typeof t&&null!==t&&(r=t,t=""),r||(r={type:"function"==typeof btoa?"basic":"auto"});return this._auth(e,t,r,function(e){if("function"==typeof btoa)return btoa(e);throw new Error("Cannot use basic auth, btoa is not a function")})},y.prototype.query=function(e){return"string"!=typeof e&&(e=p(e)),e&&this._query.push(e),this},y.prototype.attach=function(e,t,r){if(t){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(e,t,r||t.name)}return this},y.prototype._getFormData=function(){return this._formData||(this._formData=new n.FormData),this._formData},y.prototype.callback=function(e,t){if(this._shouldRetry(e,t))return this._retry();var r=this._callback;this.clearTimeout(),e&&(this._maxRetries&&(e.retries=this._retries-1),this.emit("error",e)),r(e,t)},y.prototype.crossDomainError=function(){var e=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");e.crossDomain=!0,e.status=this.status,e.method=this.method,e.url=this.url,this.callback(e)},y.prototype.buffer=y.prototype.ca=y.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},y.prototype.pipe=y.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},y.prototype._isHost=function(e){return e&&"object"==typeof e&&!Array.isArray(e)&&"[object Object]"!==Object.prototype.toString.call(e)},y.prototype.end=function(e){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=e||c,this._finalizeQueryString(),this._end()},y.prototype._end=function(){var e=this,t=this.xhr=l.getXHR(),r=this._formData||this._data;this._setTimeouts(),t.onreadystatechange=function(){var r=t.readyState;if(r>=2&&e._responseTimeoutTimer&&clearTimeout(e._responseTimeoutTimer),4==r){var n;try{n=t.status}catch(e){n=0}if(!n){if(e.timedout||e._aborted)return;return e.crossDomainError()}e.emit("end")}};var n=function(t,r){r.total>0&&(r.percent=r.loaded/r.total*100),r.direction=t,e.emit("progress",r)};if(this.hasListeners("progress"))try{t.onprogress=n.bind(null,"download"),t.upload&&(t.upload.onprogress=n.bind(null,"upload"))}catch(e){}try{this.username&&this.password?t.open(this.method,this.url,!0,this.username,this.password):t.open(this.method,this.url,!0)}catch(e){return this.callback(e)}if(this._withCredentials&&(t.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof r&&!this._isHost(r)){var i=this._header["content-type"],o=this._serializer||l.serialize[i?i.split(";")[0]:""];!o&&m(i)&&(o=l.serialize["application/json"]),o&&(r=o(r))}for(var s in this.header)null!=this.header[s]&&this.header.hasOwnProperty(s)&&t.setRequestHeader(s,this.header[s]);return this._responseType&&(t.responseType=this._responseType),this.emit("request",this),t.send(void 0!==r?r:null),this},l.agent=function(){return new u},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach(function(e){u.prototype[e.toLowerCase()]=function(t,r){var n=new l.Request(e,t);return this._setDefaults(n),r&&n.end(r),n}}),u.prototype.del=u.prototype.delete,l.get=function(e,t,r){var n=l("GET",e);return"function"==typeof t&&(r=t,t=null),t&&n.query(t),r&&n.end(r),n},l.head=function(e,t,r){var n=l("HEAD",e);return"function"==typeof t&&(r=t,t=null),t&&n.query(t),r&&n.end(r),n},l.options=function(e,t,r){var n=l("OPTIONS",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},l.del=b,l.delete=b,l.patch=function(e,t,r){var n=l("PATCH",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},l.post=function(e,t,r){var n=l("POST",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},l.put=function(e,t,r){var n=l("PUT",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n}},{"./agent-base":23,"./is-object":25,"./request-base":26,"./response-base":27,"component-emitter":14}],25:[function(e,t,r){"use strict";t.exports=function(e){return null!==e&&"object"==typeof e}},{}],26:[function(e,t,r){"use strict";var n=e("./is-object");function i(e){if(e)return function(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}(e)}t.exports=i,i.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},i.prototype.parse=function(e){return this._parser=e,this},i.prototype.responseType=function(e){return this._responseType=e,this},i.prototype.serialize=function(e){return this._serializer=e,this},i.prototype.timeout=function(e){if(!e||"object"!=typeof e)return this._timeout=e,this._responseTimeout=0,this;for(var t in e)switch(t){case"deadline":this._timeout=e.deadline;break;case"response":this._responseTimeout=e.response;break;default:console.warn("Unknown timeout option",t)}return this},i.prototype.retry=function(e,t){return 0!==arguments.length&&!0!==e||(e=1),e<=0&&(e=0),this._maxRetries=e,this._retries=0,this._retryCallback=t,this};var o=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];i.prototype._shouldRetry=function(e,t){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var r=this._retryCallback(e,t);if(!0===r)return!0;if(!1===r)return!1}catch(e){console.error(e)}if(t&&t.status&&t.status>=500&&501!=t.status)return!0;if(e){if(e.code&&~o.indexOf(e.code))return!0;if(e.timeout&&"ECONNABORTED"==e.code)return!0;if(e.crossDomain)return!0}return!1},i.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},i.prototype.then=function(e,t){if(!this._fullfilledPromise){var r=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise(function(e,t){r.end(function(r,n){r?t(r):e(n)})})}return this._fullfilledPromise.then(e,t)},i.prototype.catch=function(e){return this.then(void 0,e)},i.prototype.use=function(e){return e(this),this},i.prototype.ok=function(e){if("function"!=typeof e)throw Error("Callback required");return this._okCallback=e,this},i.prototype._isResponseOK=function(e){return!!e&&(this._okCallback?this._okCallback(e):e.status>=200&&e.status<300)},i.prototype.get=function(e){return this._header[e.toLowerCase()]},i.prototype.getHeader=i.prototype.get,i.prototype.set=function(e,t){if(n(e)){for(var r in e)this.set(r,e[r]);return this}return this._header[e.toLowerCase()]=t,this.header[e]=t,this},i.prototype.unset=function(e){return delete this._header[e.toLowerCase()],delete this.header[e],this},i.prototype.field=function(e,t){if(null==e)throw new Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),n(e)){for(var r in e)this.field(r,e[r]);return this}if(Array.isArray(t)){for(var i in t)this.field(e,t[i]);return this}if(null==t)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof t&&(t=""+t),this._getFormData().append(e,t),this},i.prototype.abort=function(){return this._aborted?this:(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort"),this)},i.prototype._auth=function(e,t,r,n){switch(r.type){case"basic":this.set("Authorization","Basic "+n(e+":"+t));break;case"auto":this.username=e,this.password=t;break;case"bearer":this.set("Authorization","Bearer "+e)}return this},i.prototype.withCredentials=function(e){return null==e&&(e=!0),this._withCredentials=e,this},i.prototype.redirects=function(e){return this._maxRedirects=e,this},i.prototype.maxResponseSize=function(e){if("number"!=typeof e)throw TypeError("Invalid argument");return this._maxResponseSize=e,this},i.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},i.prototype.send=function(e){var t=n(e),r=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),t&&!this._data)Array.isArray(e)?this._data=[]:this._isHost(e)||(this._data={});else if(e&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(t&&n(this._data))for(var i in e)this._data[i]=e[i];else"string"==typeof e?(r||this.type("form"),r=this._header["content-type"],this._data="application/x-www-form-urlencoded"==r?this._data?this._data+"&"+e:e:(this._data||"")+e):this._data=e;return!t||this._isHost(e)?this:(r||this.type("json"),this)},i.prototype.sortQuery=function(e){return this._sort=void 0===e||e,this},i.prototype._finalizeQueryString=function(){var e=this._query.join("&");if(e&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+e),this._query.length=0,this._sort){var t=this.url.indexOf("?");if(t>=0){var r=this.url.substring(t+1).split("&");"function"==typeof this._sort?r.sort(this._sort):r.sort(),this.url=this.url.substring(0,t)+"?"+r.join("&")}}},i.prototype._appendQueryString=function(){console.trace("Unsupported")},i.prototype._timeoutError=function(e,t,r){if(!this._aborted){var n=new Error(e+t+"ms exceeded");n.timeout=t,n.code="ECONNABORTED",n.errno=r,this.timedout=!0,this.abort(),this.callback(n)}},i.prototype._setTimeouts=function(){var e=this;this._timeout&&!this._timer&&(this._timer=setTimeout(function(){e._timeoutError("Timeout of ",e._timeout,"ETIME")},this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout(function(){e._timeoutError("Response timeout of ",e._responseTimeout,"ETIMEDOUT")},this._responseTimeout))}},{"./is-object":25}],27:[function(e,t,r){"use strict";var n=e("./utils");function i(e){if(e)return function(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}(e)}t.exports=i,i.prototype.get=function(e){return this.header[e.toLowerCase()]},i.prototype._setHeaderProperties=function(e){var t=e["content-type"]||"";this.type=n.type(t);var r=n.params(t);for(var i in r)this[i]=r[i];this.links={};try{e.link&&(this.links=n.parseLinks(e.link))}catch(e){}},i.prototype._setStatusProperties=function(e){var t=e/100|0;this.status=this.statusCode=e,this.statusType=t,this.info=1==t,this.ok=2==t,this.redirect=3==t,this.clientError=4==t,this.serverError=5==t,this.error=(4==t||5==t)&&this.toError(),this.created=201==e,this.accepted=202==e,this.noContent=204==e,this.badRequest=400==e,this.unauthorized=401==e,this.notAcceptable=406==e,this.forbidden=403==e,this.notFound=404==e,this.unprocessableEntity=422==e}},{"./utils":28}],28:[function(e,t,r){"use strict";r.type=function(e){return e.split(/ *; */).shift()},r.params=function(e){return e.split(/ *; */).reduce(function(e,t){var r=t.split(/ *= */),n=r.shift(),i=r.shift();return n&&i&&(e[n]=i),e},{})},r.parseLinks=function(e){return e.split(/ *, */).reduce(function(e,t){var r=t.split(/ *; */),n=r[0].slice(1,-1);return e[r[1].split(/ *= */)[1].slice(1,-1)]=n,e},{})},r.cleanHeader=function(e,t){return delete e["content-type"],delete e["content-length"],delete e["transfer-encoding"],delete e.host,t&&(delete e.authorization,delete e.cookie),e}},{}],29:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.candidates=t;var n=[{re:new RegExp(""+this.constructor.re.start+this.constructor.yearMonthNameDay.parts.map(function(e){return r.constructor.re[e]}).join(this.constructor.re.separator)+this.constructor.re.end),year:this.constructor.yearMonthNameDay.year,month:this.constructor.yearMonthNameDay.month,day:this.constructor.yearMonthNameDay.day,name:!0}];this.patterns=n.concat(["yearMonthDay","yearMonthDayWithoutSeparator","yearAndMonthName","yearAndMonth","dayMonthNameYear","dayMonthYear","monthDayYear","monthNameDayYear","monthYear","monthNameAndYear","year"].map(function(e){return r.constructor[e]}).map(function(e){return{re:new RegExp(""+r.constructor.re.start+e.parts.map(function(e){return r.constructor.re[e]}).join(void 0!==e.separator?e.separator:r.constructor.re.separator)+r.constructor.re.end),year:e.year,month:e.month,day:e.day,name:e.name}})),this.extracted=this.constructor.compact(this.candidates.map(function(e){return r.extract(e)})),this.sorted=this.extracted.sort(function(e,t){return e[0]+"-"+(e[1]||99).toString().padStart(2,"0")+"-"+(e[2]||99).toString().padStart(2,"0")<t[0]+"-"+(t[1]||99).toString().padStart(2,"0")+"-"+(t[2]||99).toString().padStart(2,"0")?-1:1}),this.publicationDate=this.sorted[0]}return n(e,[{key:"extract",value:function(e){for(var t=["january","february","march","april","may","june","july","august","september","october","november","december"],r=0;r<this.patterns.length;r+=1){var n=this.patterns[r],i=e.match(n.re);if(i){var o=null,s=!1;if(n.month&&(o=i[n.month],n.name))for(var a=o.toLowerCase(),u=0;u<t.length;u+=1){var c=t[u];c.match(a)&&(o=String(t.indexOf(c)+1),s=!0)}if(!n.month||!n.name||s)return this.constructor.compact([i[n.year],o,i[n.day]])}}return null}}],[{key:"compact",value:function(e){return e.filter(function(e){return null!=e})}}]),e}();i.re={year:"(19\\d{2}|20\\d{2})",month:"(0?[1-9]|1[012])",monthName:"([A-Za-z]{3,9})",day:"(0{0,1}[1-9]|[12][0-9]|3[01])[A-Za-z]{0,2}",start:"(^|\\D)",end:"(\\D|$)",separator:"[.,/-\\s]+"},i.yearMonthDay={parts:["year","month","day"],year:2,month:3,day:4},i.yearMonthDayWithoutSeparator={parts:["year","month","day"],year:2,month:3,day:4,separator:""},i.yearMonthNameDay={parts:["year","monthName","day"],year:2,month:3,day:4,name:!0},i.yearAndMonthName={parts:["year","monthName"],year:2,month:3,name:!0},i.yearAndMonth={parts:["year","month"],year:2,month:3},i.monthDayYear={parts:["month","day","year"],year:4,month:2,day:3},i.monthNameDayYear={parts:["monthName","day","year"],year:4,month:2,day:3,name:!0},i.dayMonthNameYear={parts:["day","monthName","year"],year:4,month:3,day:2,name:!0},i.dayMonthYear={parts:["day","month","year"],year:4,month:3,day:2,separator:"[-.\\s]+"},i.monthYear={parts:["month","year"],year:3,month:2},i.monthNameAndYear={parts:["monthName","year"],year:3,month:2,name:!0},i.year={parts:["year"],year:2},t.exports={DateParser:i}},{}],30:[function(e,t,r){"use strict";t.exports=function(e){return e.replace(/_([a-z])/g,function(e){return e[1].toUpperCase()})}},{}],31:[function(e,t,r){"use strict";var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=e("./sources"),s=e("./DateParser").DateParser,a=e("./camelCase"),u=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t)throw new Error("document is required for new MetaExtractor instance");this.options=r,this.publicationDates={},this.parse(t)}return i(e,[{key:"parse",value:function(e){var t=this,r=this.options.sources||this.constructor.defaultSources,i=this.options.meta_extractor_options,u=void 0===i?{prioritizeSelectors:void 0}:i,c=u.prioritizeSelectors,l=u.selectorsToRemoveFromInnerHTML||this.constructor.defaultSelectorsToRemoveFromInnerHTML;c&&(this.options.prioritizeSelectors=c,r=r.reduce(function(e,t){return"Selectors"===t?[t].concat(e):(e.push(t),e)},[])),this.sources=r.map(function(r){return new("string"==typeof r?o[r]:r)(e,t.options,l)}),[].slice.call(e.querySelectorAll("meta")).forEach(function(e){t.sources.forEach(function(t){t.add(e)})}),(this.options.tags||this.constructor.defaultTags).forEach(function(e){if(t.constructor.defaultDates.includes(e)){var r=(t.forCompact(e)&&t.forCompact(e).length?new s(t.forCompact(e)):{publicationDate:[]}).publicationDate,i="publication_date"===e?"original_publication_date":e,o=n(r||[],3),u=o[0],c=o[1],l=o[2];t.publicationDates[a(i)]={day:l,month:c,year:u}}else{var h="get"+t.constructor.ucCamelCase(e);t[a(e)]=t[h]?t[h]():t.firstFor(e)}})}},{key:"getPubmedId",value:function(){return this.firstFor("pubmed_id",Number)}},{key:"getDoi",value:function(){var e=this.firstFor("doi");if(e)return e.trim().replace("info:doi/","").replace(/https?:\/\//,"").replace(/(dx.)?doi.org\//,"").replace(/doi[：:]?/i,"")}},{key:"getIssn",value:function(){var e=this.firstFor("issn");if(e)return e.trim().replace("issn:","").replace("info:issn/","")}},{key:"getAuthors",value:function(){var e=this.constructor.uniq(this.forCompact("authors"));if(!(e.length>1))return e[0]||void 0;for(var t=0;t<e.length;t+=1)if(e[t])return e[t]+" et al."}},{key:"getAbstract",value:function(){var e=this.options.prioritizeSelectors?0:7;return this.sources[e].get("abstract")||this.firstFor("abstract")}},{key:"firstFor",value:function(e,t){var r=this.forCompact(e);return t&&(r=r.filter(t)),r[0]}},{key:"forCompact",value:function(e){var t=[];return this.sources.map(function(t){return t.get(e)}).forEach(function(r){t="title"===e&&r?t.concat(r.replace(/^(【In Press】|In Press):?/i,"").trim()):t.concat(r)}),this.constructor.compact(t)}},{key:"publication_year",get:function(){return this.publicationYear},set:function(e){this.publicationYear=e}},{key:"publication_month",get:function(){return this.publicationMonth},set:function(e){this.publicationMonth=e}},{key:"journal_title",get:function(){return this.journalTitle.trim()},set:function(e){this.journalTitle=e}},{key:"custom_id",get:function(){return this.customId},set:function(e){this.customId=e}}],[{key:"ucCamelCase",value:function(e){var t=a(e);return t.charAt(0).toUpperCase()+t.substr(1)}},{key:"compact",value:function(e){return e.filter(function(e){return null!=e})}},{key:"uniq",value:function(e){return e.filter(function(t,r){return e.indexOf(t)===r})}}]),e}();u.defaultSources=["HighWire","DublinCore","DCTerms","Prism","BEPress","EPrints","WolterKluwer","Selectors","OpenGraph"],u.defaultTags=["pubmed_id","doi","title","publication_date","online_publication_date","accepted_date","reviewed_date","authors","abstract"],u.defaultDates=["publication_date","online_publication_date","accepted_date","reviewed_date"],u.defaultSelectorsToRemoveFromInnerHTML=[".overlay"],t.exports={MetaExtractor:u,sources:o}},{"./DateParser":29,"./camelCase":30,"./sources":44}],32:[function(e,t,r){"use strict";var n=e("./Source"),i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),t}();i.prefix=["bepress","citation"],i.separator="_",t.exports=i},{"./Source":41}],33:[function(e,t,r){"use strict";var n=e("./Source"),i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),t}();i.defaultTags=["issn","journal_title","doi"],i.prefix="dcsext.wt",i.separator="_",i.issn="issn",i.journalTitle="name",i.doi="doi",t.exports=i},{"./Source":41}],34:[function(e,t,r){"use strict";var n=e("./Source"),i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),t}();i.defaultTags=["pubmed_id","doi","title","authors","abstract"],i.prefix="dcterms",i.authors="creator",i.abstract=["abstract","description"],i.journalTitle="publisher",i.issn="identifier.issn",t.exports=i},{"./Source":41}],35:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=e("./Source"),o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),n(t,[{key:"getIssn",value:function(){for(var e=this.forCompact("issn"),t=0;t<e.length;t+=1){var r=e[t];if(!this.constructor.checkDoi(r))return r}}},{key:"sortScore",value:function(e,r){var n=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"sortScore",this).call(this,e,r);if("doi"===e||"issn"===e){n*=10;var i=r.getAttribute("scheme");i&&i.toLowerCase()===e&&(n-=5);var o=this.clean(r.getAttribute("content"));o&&0===o.toLowerCase().indexOf(e+":")&&(n-=1)}return n}}]),t}();o.prefix="dc",o.doi=["identifier.doi","identifier"],o.authors=["creator","contributor"],o.publicationDate=["date","issued"],o.abstract=["abstract","description"],o.journalTitle="publisher",o.issn=["identifier.issn","identifier"],t.exports=o},{"./Source":41}],36:[function(e,t,r){"use strict";var n=e("./Source"),i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),t}();i.prefix="eprints",i.authors="creators_name",i.journalTitle=["publication","publisher"],t.exports=i},{"./Source":41}],37:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=e("./Source"),o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),n(t,[{key:"forCompact",value:function(e){return this.buckets[e]=this.constructor.prioritizeEngMeta(this.buckets[e]),function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"forCompact",this).call(this,e)}}],[{key:"prioritizeEngMeta",value:function(e){return[].concat(e.filter(function(e){return e.getAttribute&&"en"===e.getAttribute("xml:lang")}),e.filter(function(e){return!e.getAttribute||"en"!==e.getAttribute("xml:lang")}))}}]),t}();o.prefix="citation",o.separator="_",t.exports=o},{"./Source":41}],38:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=e("./Source"),o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),n(t,null,[{key:"nodeTag",value:function(e){var r=e.getAttribute("property");return r?r.toLowerCase():function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(n):void 0}(t.__proto__||Object.getPrototypeOf(t),"nodeTag",this).call(this,e)}}]),t}();o.prefix="og",o.separator=":",o.authors=[],o.publicationDate="article:published_time",o.abstract="description",t.exports=o},{"./Source":41}],39:[function(e,t,r){"use strict";var n=e("./Source"),i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),t}();i.prefix="prism",i.publicationDate="publicationdate",i.journalTitle="publicationname",i.issn=["eissn","issn"],t.exports=i},{"./Source":41}],40:[function(e,t,r){(function(r){(function(){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function i(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var o=e("./Source"),s=function(e){function t(e,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o.options.selectors=o.options.selectors||{},o.buckets={},o.tags.forEach(function(e){o.options.selectors[e]&&(o.buckets[e]=[].slice.call(o.document.querySelectorAll(o.options.selectors[e])).map(function(e){if("META"===e.tagName)return e.content;r.NodeList&&!r.NodeList.prototype.forEach&&(r.NodeList.prototype.forEach=Array.prototype.forEach);var t=e.cloneNode(!0);return t.querySelectorAll(i).forEach(function(e){return e.parentNode.removeChild(e)}),t.innerHTML}))}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),n(t,[{key:"forCompact",value:function(e){var t,r=this;if(!this.buckets[e])return[];var n=this.buckets[e].map(function(t){return"authors"===e?r.constructor.handleCommaSeparatedNameNotation(r.clean(t).replace(/\s*\band\b/g,",").replace(/[\d;:!?~`"'@#$%^&*()\/|\\№+=✉]+/g,"").replace(/(^\s*[,-]*\s*)|(\s*[,-]*\s*$)/g,"").split(/,\s*/).map(function(e){return e.trim()})):r.clean(t)});return(t=[]).concat.apply(t,i(n))}},{key:"add",value:function(){this.added=this.added}}],[{key:"handleCommaSeparatedNameNotation",value:function(e){var t=e[0].split(/[\s;:.!?+&*\/%]+/).filter(function(e){return e}).length;return e.length>1&&t<2?this.joinFirstTwoItemsOfArray(e):e}},{key:"joinFirstTwoItemsOfArray",value:function(e){var t=[].concat(i(e)),r=t[0],n=t[1],o=t.slice(2);return n+" "+r+(o.length?", "+o.join(", "):"")}}]),t}();t.exports=s}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Source":41}],41:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function i(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var o=e("../camelCase"),s=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.document=t,this.options=n,this.tags=this.options.tags||this.constructor.defaultTags,this.tagMap={},this.buckets={},this.tagOrder={},this.tags.forEach(function(e){r.buckets[e]=[],r.tagOrder[e]=[],[].concat(r.constructor[o(e)]).forEach(function(t){var n=r.constructor.tag(t);r.tagMap[n]=r.tagMap[n]||[],r.tagMap[n].push(e),r.tagOrder[e].push(n)})})}return n(e,[{key:"add",value:function(e){var t=this,r=this.constructor.nodeTag(e);(this.tagMap[r]||[]).forEach(function(r){e.getAttribute("content")&&t.buckets[r].push(e)})}},{key:"get",value:function(e){var t="get"+this.constructor.ucCamelCase(e);return"function"==typeof this[t]?this[t]():this.firstFor(e)}},{key:"getAuthors",value:function(){return this.forCompact("authors")}},{key:"getPublicationDate",value:function(){return this.forCompact("publication_date")}},{key:"getOnlinePublicationDate",value:function(){return this.forCompact("online_publication_date")}},{key:"getAcceptedDate",value:function(){return this.forCompact("accepted_date")}},{key:"getReviewedDate",value:function(){return this.forCompact("reviewed_date")}},{key:"getAbstract",value:function(){var e=this.forCompact("abstract");return e&&e.length?e.join(" ").trim():null}},{key:"getDoi",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"doi",t=this.forCompact(e),r=0;r<t.length;r+=1){var n=t[r];if(this.constructor.checkDoi(n))return n.trim().match(/\s/g)?n.match(/\b(10[.][0-9]{4,}(?:[.][0-9]+)*\/(?:(?!["&'])\S)+)/i):n}}},{key:"firstFor",value:function(e){return this.forCompact(e)[0]}},{key:"forCompact",value:function(e){var t,r=this;if(!this.buckets[e])return[];"authors"!==e&&this.buckets[e].sort(function(t,n){return r.sortScore(e,t)-r.sortScore(e,n)});var n=this.buckets[e].map(function(t){var n=t.getAttribute?t.getAttribute("content"):t;return"authors"===e?r.constructor.handleCommaSeparatedNameNotation(r.clean(n).replace(/\s*\band\b/g,",").replace(/[\d;:!?~`"'@#$%^&*()\/|\\№+=✉]+/g,"").replace(/(^\s*[,-]*\s*)|(\s*[,-]*\s*$)/g,"").split(/,\s*/).map(function(e){return e.trim()})):r.clean(n)});return(t=[]).concat.apply(t,i(n))}},{key:"sortScore",value:function(e,t){return(this.tagOrder[e]||"").indexOf(this.constructor.nodeTag(t))}},{key:"clean",value:function(e){return this.htmlDecode(e).replace(/[\n\t]+/g," ").replace(/\s+/g," ").trim()}},{key:"htmlDecode",value:function(e){if(!e)return"";var t=this.document.createElement("div");return t.innerHTML=e.replace(/<style.*?>.*?<\/style>|<script.*?>.*?<\/script>/g,"").replace(/(<span*>)/g,"$1 "),t.textContent}}],[{key:"checkDoi",value:function(e){return e.match(/\//g)}},{key:"tag",value:function(e){return[].concat(this.prefix).concat(e).join(this.separator)}},{key:"nodeTag",value:function(e){var t=e.getAttribute("name");return t?t.toLowerCase():"invalid"}},{key:"ucCamelCase",value:function(e){var t=o(e);return t.charAt(0).toUpperCase()+t.substr(1)}},{key:"handleCommaSeparatedNameNotation",value:function(e){var t=e[0].split(/[\s;:.!?+&*\/%]+/).filter(function(e){return e}).length;return e.length>1&&t<2?this.joinFirstTwoItemsOfArray(e):e}},{key:"joinFirstTwoItemsOfArray",value:function(e){var t=[].concat(i(e)),r=t[0],n=t[1],o=t.slice(2);return n+" "+r+(o.length?", "+o.join(", "):"")}}]),e}();s.prefix=[],s.separator=".",s.defaultTags=["pubmed_id","doi","title","authors","publication_date","online_publication_date","accepted_date","reviewed_date","abstract"],s.pubmedId=["pubmed_id","pmid"],s.doi="doi",s.title="title",s.authors=["authors","author"],s.publicationDate=["publication_date","date"],s.onlinePublicationDate="online_publication_date",s.acceptedDate="accepted_date",s.reviewedDate="reviewed_date",s.abstract="abstract",s.journalTitle=["journal_title","journal_abbrev"],s.issn="issn",t.exports=s},{"../camelCase":30}],42:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=e("./Source"),o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),n(t,[{key:"getCustomId",value:function(){var e=this.document.querySelector('meta[name="pbContext"]');if(e&&e.content){var t=new RegExp("journal\\:journal\\:(\\w+?)(?:\\W|$)").exec(e.content);if(t&&t.length>1)return t[1]}return null}}]),t}();t.exports=o},{"./Source":41}],43:[function(e,t,r){"use strict";var n=e("./Source"),i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),t}();i.prefix="wkhealth",i.separator="_",t.exports=i},{"./Source":41}],44:[function(e,t,r){"use strict";var n=e("./Source"),i=e("./HighWire"),o=e("./DublinCore"),s=e("./Prism"),a=e("./BEPress"),u=e("./EPrints"),c=e("./OpenGraph"),l=e("./WolterKluwer"),h=e("./DCTerms"),p=e("./Selectors"),d=e("./TandFonline"),f=e("./DCSext");t.exports={Source:n,HighWire:i,DublinCore:o,Prism:s,BEPress:a,EPrints:u,OpenGraph:c,WolterKluwer:l,DCTerms:h,Selectors:p,TandFonline:d,DCSext:f}},{"./BEPress":32,"./DCSext":33,"./DCTerms":34,"./DublinCore":35,"./EPrints":36,"./HighWire":37,"./OpenGraph":38,"./Prism":39,"./Selectors":40,"./Source":41,"./TandFonline":42,"./WolterKluwer":43}],45:[function(e,t,r){"use strict";var n=e("punycode"),i=e("./util");function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}r.parse=v,r.resolve=function(e,t){return v(e,!1,!0).resolve(t)},r.resolveObject=function(e,t){return e?v(e,!1,!0).resolveObject(t):t},r.format=function(e){i.isString(e)&&(e=v(e));return e instanceof o?e.format():o.prototype.format.call(e)},r.Url=o;var s=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,u=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(c),h=["%","/","?",";","#"].concat(l),p=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},b=e("querystring");function v(e,t,r){if(e&&i.isObject(e)&&e instanceof o)return e;var n=new o;return n.parse(e,t,r),n}o.prototype.parse=function(e,t,r){if(!i.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),a=-1!==o&&o<e.indexOf("#")?"?":"#",c=e.split(a);c[0]=c[0].replace(/\\/g,"/");var v=e=c.join(a);if(v=v.trim(),!r&&1===e.split("#").length){var w=u.exec(v);if(w)return this.path=v,this.href=v,this.pathname=w[1],w[2]?(this.search=w[2],this.query=t?b.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var _=s.exec(v);if(_){var k=(_=_[0]).toLowerCase();this.protocol=k,v=v.substr(_.length)}if(r||_||v.match(/^\/\/[^@\/]+@[^@\/]+/)){var C="//"===v.substr(0,2);!C||_&&g[_]||(v=v.substr(2),this.slashes=!0)}if(!g[_]&&(C||_&&!y[_])){for(var O,x,E=-1,P=0;P<p.length;P++){-1!==(j=v.indexOf(p[P]))&&(-1===E||j<E)&&(E=j)}-1!==(x=-1===E?v.lastIndexOf("@"):v.lastIndexOf("@",E))&&(O=v.slice(0,x),v=v.slice(x+1),this.auth=decodeURIComponent(O)),E=-1;for(P=0;P<h.length;P++){var j;-1!==(j=v.indexOf(h[P]))&&(-1===E||j<E)&&(E=j)}-1===E&&(E=v.length),this.host=v.slice(0,E),v=v.slice(E),this.parseHost(),this.hostname=this.hostname||"";var T="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!T)for(var S=this.hostname.split(/\./),I=(P=0,S.length);P<I;P++){var R=S[P];if(R&&!R.match(d)){for(var A="",L=0,D=R.length;L<D;L++)R.charCodeAt(L)>127?A+="x":A+=R[L];if(!A.match(d)){var q=S.slice(0,P),N=S.slice(P+1),M=R.match(f);M&&(q.push(M[1]),N.unshift(M[2])),N.length&&(v="/"+N.join(".")+v),this.hostname=q.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),T||(this.hostname=n.toASCII(this.hostname));var U=this.port?":"+this.port:"",W=this.hostname||"";this.host=W+U,this.href+=this.host,T&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==v[0]&&(v="/"+v))}if(!m[k])for(P=0,I=l.length;P<I;P++){var H=l[P];if(-1!==v.indexOf(H)){var G=encodeURIComponent(H);G===H&&(G=escape(H)),v=v.split(H).join(G)}}var F=v.indexOf("#");-1!==F&&(this.hash=v.substr(F),v=v.slice(0,F));var B=v.indexOf("?");if(-1!==B?(this.search=v.substr(B),this.query=v.substr(B+1),t&&(this.query=b.parse(this.query)),v=v.slice(0,B)):t&&(this.search="",this.query={}),v&&(this.pathname=v),y[k]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){U=this.pathname||"";var z=this.search||"";this.path=U+z}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,s="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(s=b.stringify(this.query));var a=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||y[t])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),t+o+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(a=a.replace("#","%23"))+n},o.prototype.resolve=function(e){return this.resolveObject(v(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(i.isString(e)){var t=new o;t.parse(e,!1,!0),e=t}for(var r=new o,n=Object.keys(this),s=0;s<n.length;s++){var a=n[s];r[a]=this[a]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var u=Object.keys(e),c=0;c<u.length;c++){var l=u[c];"protocol"!==l&&(r[l]=e[l])}return y[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!y[e.protocol]){for(var h=Object.keys(e),p=0;p<h.length;p++){var d=h[p];r[d]=e[d]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||g[e.protocol])r.pathname=e.pathname;else{for(var f=(e.pathname||"").split("/");f.length&&!(e.host=f.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),r.pathname=f.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var m=r.pathname||"",b=r.search||"";r.path=m+b}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var v=r.pathname&&"/"===r.pathname.charAt(0),w=e.host||e.pathname&&"/"===e.pathname.charAt(0),_=w||v||r.host&&e.pathname,k=_,C=r.pathname&&r.pathname.split("/")||[],O=(f=e.pathname&&e.pathname.split("/")||[],r.protocol&&!y[r.protocol]);if(O&&(r.hostname="",r.port=null,r.host&&(""===C[0]?C[0]=r.host:C.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===f[0]?f[0]=e.host:f.unshift(e.host)),e.host=null),_=_&&(""===f[0]||""===C[0])),w)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,C=f;else if(f.length)C||(C=[]),C.pop(),C=C.concat(f),r.search=e.search,r.query=e.query;else if(!i.isNullOrUndefined(e.search)){if(O)r.hostname=r.host=C.shift(),(T=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=T.shift(),r.host=r.hostname=T.shift());return r.search=e.search,r.query=e.query,i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!C.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var x=C.slice(-1)[0],E=(r.host||e.host||C.length>1)&&("."===x||".."===x)||""===x,P=0,j=C.length;j>=0;j--)"."===(x=C[j])?C.splice(j,1):".."===x?(C.splice(j,1),P++):P&&(C.splice(j,1),P--);if(!_&&!k)for(;P--;P)C.unshift("..");!_||""===C[0]||C[0]&&"/"===C[0].charAt(0)||C.unshift(""),E&&"/"!==C.join("/").substr(-1)&&C.push("");var T,S=""===C[0]||C[0]&&"/"===C[0].charAt(0);O&&(r.hostname=r.host=S?"":C.length?C.shift():"",(T=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=T.shift(),r.host=r.hostname=T.shift()));return(_=_||r.host&&C.length)&&!S&&C.unshift(""),C.length?r.pathname=C.join("/"):(r.pathname=null,r.path=null),i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},o.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{"./util":46,punycode:16,querystring:19}],46:[function(e,t,r){"use strict";t.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},{}],47:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/helpers/slicedToArray")),o=n(e("@babel/runtime/helpers/classCallCheck")),s=n(e("@babel/runtime/helpers/createClass")),a=function(){function e(t){var r=this;(0,o.default)(this,e),t&&(t.split(",").forEach(function(e){if(-1!==e.indexOf("=")){var t=e.split("="),n=(0,i.default)(t,2),o=n[0],s=n[1];r[r.trim(o)]=r.trim(s)}else r[r.trim(e)]=!0}),this.abstract=parseInt(this.abstract,10))}return(0,s.default)(e,[{key:"trim",value:function(e){return e.replace(/^\s+|\s+$/g,"")}}]),e}();r.default=a},{"@babel/runtime/helpers/classCallCheck":4,"@babel/runtime/helpers/createClass":5,"@babel/runtime/helpers/interopRequireDefault":7,"@babel/runtime/helpers/slicedToArray":10}],48:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/regenerator")),o=n(e("@babel/runtime/helpers/asyncToGenerator")),s=n(e("@babel/runtime/helpers/classCallCheck")),a=n(e("@babel/runtime/helpers/createClass")),u=n(e("superagent")),c=n(e("./TimeLogger")),l=function(){function e(t){var r=t.gdpr,n=t.dtConfig,i=t.eventLogger,o=t.queryParams,a=t.tag,u=t.websiteProperties;(0,s.default)(this,e),this.dtConfig=n,this.switches={},this.eventLogger=i,this.queryParams=o,this.res={},this.tag=a,this._gdpr=r,this._dtAdded=!1,this._websiteProperties=u,this._detectionStartedLhk=!1,this._detectionStartedDmd=!1,this.callbackAfterLhk=null,this.callbackAfterLiveRamp=null}return(0,a.default)(e,[{key:"detectionStarted",get:function(){return this._detectionStartedLhk&&this._detectionStartedDmd}},{key:"addDt",value:function(){var e=(0,o.default)(i.default.mark(function e(){var t,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._dtAdded){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,this._websiteProperties.get();case 4:if(this.switches=e.sent.switches,this._gdpr.switches=this.switches,this.dtConfig&&!this.switches.gdpr&&this.switches.isUS&&this._gdpr.prConsent){e.next=8;break}return e.abrupt("return",!1);case 8:if(t=!!this.switches.swoop&&this.switches.swoop.cbOnly,r=!!this.switches.swoop&&!!this.switches.swoop.swi,this.switches.dt||t){e.next=12;break}return e.abrupt("return",!1);case 12:return r&&this.dtConfig.liveRamp&&this.requestIdentificationLink(),this.dtConfig.dmd&&this._addDmdIframe(),this.dtConfig.lhk&&this._makeLhkReq(),this._dtAdded=!0,e.abrupt("return",!0);case 17:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_addDmdIframe",value:function(){var e=this,t=document.createElement("iframe");if(t.setAttribute("style","display:none!important"),"function"!=typeof t.getAttribute)return!1;var r=Date.now(),n=window.location.origin,i="?client-origin=".concat(n,"&timestamp=").concat(r);return this.dtConfig.dmd.permittedOrigin="".concat(this.dtConfig.dmd.origin),t.src="".concat(this.dtConfig.dmd.permittedOrigin).concat(this.dtConfig.dmd.path).concat(i),document.body.appendChild(t),window.addEventListener("message",function(t){return e.dmdPostMessageHandler(t)},!1),!0}},{key:"_makeLhkReq",value:function(){var e=this;u.default.get(this.dtConfig.lhk.api).query({test:"true"}).withCredentials().end(function(t,r){t||(e._detectionStartedLhk=!0,e.eventLogger.log({},{lhk:r.body,switches:e.switches}),"function"==typeof e.callbackAfterLhk&&e.callbackAfterLhk(r.body))})}},{key:"requestIdentificationLink",value:function(){var e=this,t="".concat(this.dtConfig.liveRamp.api,"?pid=").concat("7");u.default.get(t).withCredentials().end(function(t,r){if(t)e.callbackAfterLiveRamp("");else{var n=r.body||JSON.parse(r.text),i=n.idl;e.callbackAfterLiveRamp(i),e.eventLogger.log({},{liveRamp:n,switches:e.switches})}})}},{key:"dmdPostMessageHandler",value:function(e){e.origin===this.dtConfig.dmd.permittedOrigin&&(this._detectionStartedDmd=!0,this.res=e.data,c.default.log("dt"),this.eventLogger.dmdObj=this.dmdObj(),c.default.times.recos&&this.eventLogger.log({},{dmd:this.dmdObj(),switches:this.switches}))}},{key:"dmdObj",value:function(){if(!this.dtConfig||!this.dtConfig.dmd||!this.switches.dt)return!1;for(var e={url:document.location.href,title:document.title,article:this.queryParams(),referrer:document.referrer,time:new Date,recos:[],iframe:{data:this.res,iframeResponse:c.default.times.dt,recosVisible:c.default.times.recos}},t=document.getElementsByClassName("".concat(this.tag,"-widget-list-item__link")),r=0;r<t.length;r++){var n=t[r];e.recos.push(n.getAttribute("data-".concat(this.tag,"-id")))}return e}}]),e}();r.default=l},{"./TimeLogger":57,"@babel/runtime/helpers/asyncToGenerator":3,"@babel/runtime/helpers/classCallCheck":4,"@babel/runtime/helpers/createClass":5,"@babel/runtime/helpers/interopRequireDefault":7,"@babel/runtime/regenerator":12,superagent:24}],49:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/helpers/classCallCheck")),o=n(e("@babel/runtime/helpers/createClass")),s=n(e("superagent")),a=function(){function e(t){(0,i.default)(this,e),this.tag=t.tag,this.version=t.version,this.relevancyUrl=t.relevancyUrl,this.eventsEndpoint="/events",this.swoopObj={},this.dmdObj={},this.switches={},this.stack=[],this.concurrent=0,this._stackInterval=0,this._stackInProgress=!1,this.hasAdBlock=null}return(0,o.default)(e,[{key:"log",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this.stack.push({events:e,misc:r,cb:n}),this._stackInterval||(this._log(),this._stackInterval=setInterval(function(){!t._stackInProgress&&t.stack.length&&t._log()},200))}},{key:"_log",value:function(){var e=this;this._stackInProgress=!0;var t=this.stack.pop(),r=t.events,n=t.misc,i=t.cb;return n.switches=n.switches||this.switches||{},this.concurrent+=1,s.default.post(this.relevancyUrl+this.eventsEndpoint).set("".concat(this.tag,"-widget-version"),this.version).withCredentials().send({events:r,misc:n}).end(function(t,r){e.concurrent-=1,e._stackInProgress=!1,"function"==typeof i&&i(r)})}}]),e}();r.default=a},{"@babel/runtime/helpers/classCallCheck":4,"@babel/runtime/helpers/createClass":5,"@babel/runtime/helpers/interopRequireDefault":7,superagent:24}],50:[function(e,t,r){(function(t){(function(){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/helpers/slicedToArray")),o=n(e("@babel/runtime/helpers/defineProperty")),s=n(e("@babel/runtime/helpers/classCallCheck")),a=n(e("@babel/runtime/helpers/createClass")),u=n(e("./TimeLogger")),c=function(){function e(t){var r=t.config,n=t.eventLogger;(0,s.default)(this,e),this.tag=r.tag,this.version=r.version,this.testID=null,this.journalId=null,this.articleId=null,this.contentCategory=null,this.elements={},this.eventsStoreKey="".concat(this.tag,"SentEvents"),this.attributes={articleId:"data-".concat(this.tag,"-id"),journalId:"data-".concat(this.tag,"-journal-id"),contentCategory:"data-".concat(this.tag,"-content-category"),sponsored:"data-".concat(this.tag,"-sponsored"),campaignId:"data-".concat(this.tag,"-campaign-id"),ct:"data-".concat(this.tag,"-ct"),flags:"data-".concat(this.tag,"-flags"),modelType:"data-".concat(this.tag,"-model-type")},this.selectors={organic:"a[data-".concat(this.tag,'-sponsored="false"]'),sponsored:"a[data-".concat(this.tag,'-sponsored="true"]')},this._eventLogger=n,this.anonymId=r.anonymId,this.disableEvents=!!this.getHealthNetworkMonitorCookie(),this.isTmd=!0,this.checkIfTmd()}return(0,a.default)(e,[{key:"checkIfTmd",value:function(){try{var e=Array.from(document.querySelectorAll("script"));this.isTmd=Boolean(e.find(function(e){return/js\.trendmd\.com\/trendmd\.min\.js/.test(e.src)}))}catch(e){this.isTmd=!1}}},{key:"switches",set:function(e){this._eventLogger.switches=e}},{key:"impression",value:function(e,t){var r=this;if(!this.disableEvents){var n={},i=[],o=[];e.forEach(function(e){for(var t=r.nodes("organic",e),s=0;s<t.length;s++){i.push(r.params(t[s]));var a=t[s].getAttribute(r.attributes.articleId);n[a]=t[s].getAttribute(r.attributes.ct)}for(var u=r.nodes("sponsored",e),c=0;c<u.length;c++){o.push(r.params(u[c]));var l=u[c].getAttribute(r.attributes.articleId);n[l]=u[c].getAttribute(r.attributes.ct)}});var s={"organic-impressions":i,"sponsored-impressions":o};if(!this.hasSentImpressionsEvents(s)){var a=i.length+o.length<t;this._eventLogger.log(s,{"loading-times":u.default.times,dmd:this._eventLogger.dmdObj,swoop:this._eventLogger.swoopObj,hasAdBlock:this._eventLogger.hasAdBlock,testID:this.testID,widgetVersion:this.isTmd?this.version:"".concat(this.version,"-ntmd"),websiteId:this.journalId,articleId:this.articleId,ct:n,hasInsufficientRecommendations:a,anonymId:this.anonymId})}}}},{key:"click",value:function(e){if(!this.disableEvents){var t=e.getAttribute(this.attributes.articleId),r=e.getAttribute(this.attributes.ct),n="true"===e.getAttribute(this.attributes.sponsored)?"sponsored":"organic",i={dt:this._eventLogger.dmdObj,swoop:this._eventLogger.swoopObj,testID:this.testID,ct:(0,o.default)({},t,r),anonymId:this.anonymId};u.default.times.timeToClickStart&&(u.default.log("timeToClick","timeToClickStart"),i.ttc=u.default.times.timeToClick),this._eventLogger.log((0,o.default)({},"".concat(n,"-recommendations"),[this.params(e)]),i)}}},{key:"hasSentImpressionsEvents",value:function(e){var r=JSON.stringify(e);return t[this.eventsStoreKey]||(t[this.eventsStoreKey]=[]),!!t[this.eventsStoreKey].includes(r)||(t[this.eventsStoreKey].push(r),!1)}},{key:"nodes",value:function(e,t){return this.elements&&void 0!==this.elements[t]?this.elements[t].querySelectorAll(this.selectors[e]):[]}},{key:"params",value:function(e){return{from_journal_id:this.journalId,from_article_id:this.articleId,from_content_category:this.contentCategory,to_journal_id:e.getAttribute(this.attributes.journalId),to_article_id:e.getAttribute(this.attributes.articleId),to_content_category:e.getAttribute(this.attributes.contentCategory),campaign_id:e.getAttribute(this.attributes.campaignId),flags:e.getAttribute(this.attributes.flags),model_type:e.getAttribute(this.attributes.modelType)}}},{key:"getHealthNetworkMonitorCookie",value:function(){var e=document.cookie.split(";").map(function(e){var t=e.split("="),r=(0,i.default)(t,2);return{name:r[0],value:r[1]}});return e.find(function(e){return"TrendMD_Health_Network_Monitor"===e.name})}}]),e}();r.default=c}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./TimeLogger":57,"@babel/runtime/helpers/classCallCheck":4,"@babel/runtime/helpers/createClass":5,"@babel/runtime/helpers/defineProperty":6,"@babel/runtime/helpers/interopRequireDefault":7,"@babel/runtime/helpers/slicedToArray":10}],51:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/helpers/classCallCheck")),o=n(e("@babel/runtime/helpers/createClass")),s=function(){function e(t){var r=t.eventLogger,n=t.tag;(0,i.default)(this,e),this.dns=null,this.loggedIn=!1,this.prConsent=null,this.trConsent=null,this.gaConsent=null,this.gaClientId=null,this.gaConsentInGdpr=null,this.newClientId=!1,this.gdpr=!0,this.isUS=!1,this.gaCode="UA-139886559-1",this.tag=n,this.eventLogger=r,this.sessionCookieName="".concat(this.tag,"-disable-gdpr-ga-popup"),this.flag="cf_widget_j",this.journalId=null,this.widgetIsLoaded=!1}return(0,o.default)(e,[{key:"switches",set:function(e){var t=Object.assign({},e);t.mainCookie=t.mainCookie||{},null!==t.isUS&&(this.isUS=t.isUS),null!==t.gdpr&&(this.gdpr=t.gdpr),t.gaCode&&(this.gaCode=t.gaCode),this.loggedIn=t.loggedIn,this.gaConsent=!this.gdpr||this.loggedIn,this.prConsent=!0,this.trConsent=!0,this.dns=!1,t.mainCookie.ga&&t.mainCookie.ga.consent===!!t.mainCookie.ga.consent&&(this.gaConsent=t.mainCookie.ga.consent,this.gaClientId=t.mainCookie.ga.clientId),this.loggedIn?this.prConsent=t.mainCookie.pr:t.mainCookie.pr&&t.mainCookie.pr.consent===!!t.mainCookie.pr.consent&&(this.prConsent=t.mainCookie.pr.consent),t.mainCookie.dns===!!t.mainCookie.dns&&(this.dns=t.mainCookie.dns),t.mainCookie.tr===!!t.mainCookie.tr&&(this.trConsent=t.mainCookie.tr),t.mainCookie&&t.mainCookie.gdprGaConsent&&(this.gaConsentInGdpr=!0),void 0!==t.mainCookieWasCleared&&!0===t.mainCookieWasCleared&&this._clearSessionCookie()}},{key:"addGaTrackingCode",value:function(e,t,r){var n=this;e&&(this.gaCode=e),t&&(this.flag=t),this._addGaTrackingCode(function(){n.loggedIn?n.newClientId?n._registerGaConsent(!0,function(e){e||n._gaTrackPageView()}):n.gaConsent&&n._gaTrackPageView():n.gdpr&&!n.gaConsent?navigator.cookieEnabled&&-1!==document.cookie.indexOf(n.sessionCookieName)||("function"==typeof r?r():n._askForGaConsent()):n.newClientId?n._registerGaConsent(!0,function(e){e||n._gaTrackPageView()}):n._gaTrackPageView()})}},{key:"_addGaTrackingCode",value:function(e){var t,r,n,i,o,s,a,u=this;t=window,r=document,n="script",i="//www.google-analytics.com/analytics.js",o="ga",t.GoogleAnalyticsObject=o,t[o]=t[o]||function(){return(t[o].q=t[o].q||[]).push(arguments)},t[o].l=1*new Date,s=r.createElement(n),a=r.getElementsByTagName(n)[0],s.async=1,s.src=i,a.parentNode.insertBefore(s,a),this.gaClientId?ga("create",this.gaCode,"auto",{storage:"none",name:"tmdWidget",clientId:this.gaClientId}):ga("create",this.gaCode,"auto",{storage:"none",name:"tmdWidget"}),ga("set","anonymizeIp",!0),ga(function(){"function"==typeof ga.getAll&&ga.getAll().forEach(function(t){"tmdWidget"===t.get("name")&&(u.gaClientId||(u.gaClientId=t.get("clientId"),u.newClientId=!0),e())})})}},{key:"_gaTrackPageView",value:function(){"cf_widget"===this.flag.substring(0,9)?ga("tmdWidget.send","pageview","".concat(window.location.hostname,"/").concat(this.journalId)):ga("tmdWidget.send","pageview")}},{key:"_askForGaConsent",value:function(){document.getElementsByClassName("".concat(this.tag,"-widget-cookie-notification")).length&&(this._hideProgress(),document.getElementsByClassName("".concat(this.tag,"-widget-cookie-notification"))[0].setAttribute("style","display: block!important"))}},{key:"_registerGaConsent",value:function(e){var t=this,r=function(){var r=t.flag;"cf_widget"===t.flag.substring(0,9)&&(r="".concat(t.flag).concat(t.journalId)),t.eventLogger.log({},{gdprGaConsent:{gdpr:t.gdpr,gaClientId:t.gaClientId,gaCode:t.gaCode,gaConsent:t.gaConsent,gaConsentInGdpr:t.gaConsentInGdpr,flag:r}},function(r){r&&r.ok?(t.gaConsent&&t._gaTrackPageView(),"function"==typeof e&&e(!1),t.gdpr&&(document.cookie="".concat(t.sessionCookieName,"=1;path=/"))):r&&r.ok||"function"==typeof e&&e({error:"other"})})};if(!this.gdpr&&this.eventLogger.concurrent>0)var n=setInterval(function(){0===t.eventLogger.concurrent&&(r(),clearInterval(n))},500);else r()}},{key:"_handleGaConsentError",value:function(){var e=this;this._hideConsentFooter(),clearTimeout(this._handleGaConsentErrorTimeout),this._handleGaConsentErrorTimeout=setTimeout(function(){e._askForGaConsent()},500)}},{key:"_hideConsentFooter",value:function(){var e=document.getElementsByClassName("".concat(this.tag,"-widget-cookie-notification"));if(e)for(var t=0;t<e.length;t++)e[t]&&"function"==typeof e[t].setAttribute&&e[t].setAttribute("style","display: none!important")}},{key:"_showProgress",value:function(){var e=this;document.querySelectorAll(".".concat(this.tag,"-widget-cookie-notification button")).forEach(function(e){return e.style.display="none"});var t=document.querySelectorAll(".".concat(this.tag,"-widget-cookie-notification span"))[1];clearInterval(this._showProgressInterval),this._showProgressDots=1,this._showProgressInterval=setInterval(function(){for(var r="Saving",n=0;n<e._showProgressDots;n++)r="".concat(r,".");t&&(t.innerHTML=r),e._showProgressDots+=1,e._showProgressDots>3&&(e._showProgressDots=1)},500)}},{key:"_hideProgress",value:function(){document.querySelectorAll(".".concat(this.tag,"-widget-cookie-notification button")).forEach(function(e){return e.style.display="inline-block"});var e=document.querySelectorAll(".".concat(this.tag,"-widget-cookie-notification span"))[1];clearInterval(this._showProgressInterval),e.innerHTML=""}},{key:"_clearSessionCookie",value:function(){document.cookie="".concat(this.sessionCookieName,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;")}},{key:"setGaConsent",value:function(e,t){var r=this,n=t;return"function"!=typeof n&&(n=function(e){e?r._handleGaConsentError():r._hideConsentFooter()}),navigator.cookieEnabled?(this.gaConsent=!0===e,this._showProgress(),this._registerGaConsent(n)):n({error:"cookie"})}},{key:"setPrConsent",value:function(e,t,r){return navigator.cookieEnabled?(this.prConsent=!0===e,this.trConsent=!0===t,this.eventLogger.log({},{gdprPrConsent:{gdpr:this.gdpr,prConsent:this.prConsent,trConsent:this.trConsent}},function(e){"function"==typeof r&&(e.ok?r(!1):e.ok||r({error:"other"}))})):r({error:"cookie"})}},{key:"setDns",value:function(e,t){return navigator.cookieEnabled?(this.dns=!0===e,this.eventLogger.log({},{dns:this.dns},function(e){"function"==typeof t&&(e.ok?t(!1):e.ok||t({error:"other"}))})):t({error:"cookie"})}}]),e}();r.default=s},{"@babel/runtime/helpers/classCallCheck":4,"@babel/runtime/helpers/createClass":5,"@babel/runtime/helpers/interopRequireDefault":7}],52:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/helpers/defineProperty")),o=n(e("@babel/runtime/regenerator")),s=n(e("@babel/runtime/helpers/asyncToGenerator")),a=n(e("@babel/runtime/helpers/classCallCheck")),u=n(e("@babel/runtime/helpers/createClass")),c=n(e("./WebsiteProperties")),l=n(e("./Events")),h=n(e("./EventLogger")),p=n(e("./Recommendations")),d=n(e("./WidgetInstances")),f=n(e("./Integrations")),m=n(e("./GDPR")),g=n(e("./DT")),y=n(e("./TimeLogger"));function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach(function(t){(0,i.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var w=function(){function e(t){(0,a.default)(this,e),this.APIconfig=t,this.tag=t.tag,this.version=t.version,window.trendmdGlobalState=window.trendmdGlobalState||{},window.trendmdGlobalState.cache=window.trendmdGlobalState.cache||{},window.trendmdGlobalState.urlLocked=window.trendmdGlobalState.urlLocked||new Set,this.displayWidgetOnDemand=null,this.dt=null,this.eventLogger=null,this.events=null,this.gdprInstance=null,this.integrations=null,this.recommendations=null,this.websiteProperties=null,this.widgetInstances=null,this.widgetOptions=null,this.APIconfig.anonymId=this.uuidv4(),this._getOptions(),this.widgetOptions&&this.register()}return(0,u.default)(e,[{key:"validateWidgetOptions",value:function(e){return!(!(t=e)||"[object Object]"!==Object.prototype.toString.call(t))||(console.error("Widget load has failed, options passed to data-".concat(this.tag,"config|TrendMD.register()|displayWidget() are invalid")),!1);var t}},{key:"populateWidgetOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.validateWidgetOptions(e)&&(this.displayWidgetOnDemand=e.displayWidgetOnDemand||null,this.widgetOptions=e)}},{key:"cleanUpThePage",value:function(){var e=(0,s.default)(o.default.mark(function e(){var t,r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.widgetOptions||this.websiteProperties){e.next=2;break}return e.abrupt("return");case 2:if(t=[],this.widgetOptions&&this.widgetOptions.element&&t.push(this.widgetOptions.element),!this.websiteProperties){e.next=10;break}return e.next=7,this.websiteProperties.get();case 7:r=e.sent,r.widgets.forEach(function(e){e.placementSelector&&t.push(e.placementSelector)});case 10:n=t.join(),document.querySelectorAll(n).forEach(function(e){e.innerText=""});case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"register",value:function(){var e=(0,s.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&this.populateWidgetOptions(t),this.widgetOptions){e.next=3;break}return e.abrupt("return");case 3:if(y.default.init(),this.eventLogger||(this.eventLogger=new h.default(this.APIconfig)),this.events||(this.events=new l.default({config:this.APIconfig,eventLogger:this.eventLogger})),this.displayWidgetOnDemand){e.next=9;break}return e.next=9,this.displayWidget();case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"displayWidget",value:function(){var e=(0,s.default)(o.default.mark(function e(t){var r=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!this.displayWidgetOnDemand&&this.websiteProperties&&this.recommendations&&this.gdprInstance&&this.dt&&this.widgetInstances)){e.next=2;break}return e.abrupt("return");case 2:if(!t){e.next=6;break}return e.next=5,this.cleanUpThePage();case 5:this.populateWidgetOptions(v(v({},this.widgetOptions),{},{doi:t.doi||null,issn:t.issn||null,url:t.url||null,journal_id:t.journal_id||null,title:t.title||null}));case 6:return this.websiteProperties=new c.default({apiUrl:this.APIconfig.apiUrl,options:this.widgetOptions,version:this.version,tag:this.tag}),this.recommendations=new p.default({config:this.APIconfig,websiteProperties:this.websiteProperties,options:this.widgetOptions}),this.gdprInstance=new m.default({tag:this.tag,eventLogger:this.eventLogger}),this.dt=new g.default({dtConfig:this.APIconfig.dtConfig,eventLogger:this.eventLogger,queryParams:function(){return r.recommendations.queryParams()},tag:this.tag,gdpr:this.gdprInstance,websiteProperties:this.websiteProperties}),this.integrations=new f.default({config:this.APIconfig,eventLogger:this.eventLogger,websiteProperties:this.websiteProperties,dt:this.dt}),this.widgetInstances=new d.default({config:this.APIconfig,events:this.events,websiteProperties:this.websiteProperties,options:this.widgetOptions,recommendations:this.recommendations,integrations:this.integrations,gdpr:this.gdprInstance}),e.next=14,this.dt.addDt();case 14:return e.next=16,this.integrations.run();case 16:if(this.integrations.swoopOnly){e.next=20;break}return e.next=19,this.recommendations.run();case 19:this.widgetInstances.init();case 20:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"gdpr",value:function(e){var t=this;if(this.gdprInstance)"function"==typeof e&&e();else{y.default.init();var r=new c.default({apiUrl:this.APIconfig.apiUrl,options:{journal_id:1},version:this.version,tag:this.tag});this.eventLogger||(this.eventLogger=new h.default(this.APIconfig)),this.gdprInstance||(this.gdprInstance=new m.default({tag:this.tag,eventLogger:this.eventLogger})),Promise.resolve(r.get()).then(function(r){t.gdprInstance.journalId=r.id,t.gdprInstance.switches=r.switches,t.eventLogger.switches=r.switches,"function"==typeof e&&e()})}return this.gdprInstance}},{key:"_getURLParam",value:function(e){var t=new RegExp("[?|&]".concat(e,"=([^&;]+?)(&|#|;|$)")).exec(window.location.search),r=!1;return t&&t.length&&(r=t[1].replace(/\+/g,"%20"),r=decodeURIComponent(t[1])),r}},{key:"ampHelper",value:function(){window.parent.postMessage({sentinel:"amp",type:"embed-size",height:document.body.scrollHeight},"*");for(var e=document.getElementsByClassName("".concat(this.tag,"-widget-list-item__link")),t=0;t<e.length;t++)e[t].setAttribute("target","_blank")}},{key:"_getOptions",value:function(){var e=this,t=document.currentScript||function(){for(var t=document.getElementsByTagName("script"),r="",n=0;n<t.length;n++){var i=t[n];i.getAttribute("data-".concat(e.tag,"config"))&&(r=i)}return r}();if(t)if(t.getAttribute("data-amp")||null)this.populateWidgetOptions({title:this._getURLParam("title"),doi:this._getURLParam("doi"),journal_id:this._getURLParam("journalId"),issn:this._getURLParam("issn"),pubmed_id:this._getURLParam("pubmed"),url:this._getURLParam("url"),custom:this._getURLParam("custom"),element:"#".concat(this.tag,"-suggestions")}),this.ampHelper();else{var r=t.getAttribute("data-".concat(this.tag,"config"));if(!r)return;var n=r.replace(/'/g,'"'),i=JSON.parse(n);this.populateWidgetOptions(i)}}},{key:"uuidv4",value:function(){var e=(new Date).getTime(),t=0;try{t=performance&&performance.now&&1e3*performance.now()||0}catch(e){}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var n=16*Math.random();return e>0?(n=(e+n)%16|0,e=Math.floor(e/16)):(n=(t+n)%16|0,t=Math.floor(t/16)),("x"===r?n:3&n|8).toString(16)})}}]),e}();r.default=w},{"./DT":48,"./EventLogger":49,"./Events":50,"./GDPR":51,"./Integrations":53,"./Recommendations":54,"./TimeLogger":57,"./WebsiteProperties":58,"./WidgetInstances":60,"@babel/runtime/helpers/asyncToGenerator":3,"@babel/runtime/helpers/classCallCheck":4,"@babel/runtime/helpers/createClass":5,"@babel/runtime/helpers/defineProperty":6,"@babel/runtime/helpers/interopRequireDefault":7,"@babel/runtime/regenerator":12}],53:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/regenerator")),o=n(e("@babel/runtime/helpers/asyncToGenerator")),s=n(e("@babel/runtime/helpers/classCallCheck")),a=n(e("@babel/runtime/helpers/createClass")),u=n(e("superagent")),c=-2,l=-1,h=0,p=function(){function e(t){var r=this,n=t.config,i=t.websiteProperties,o=t.eventLogger,a=t.dt;(0,s.default)(this,e),this.apiUrl=n.apiUrl,this.swoopScriptUrl=n.swoopScriptUrl,this.tag=n.tag,this.version=n.version,this.integrationsEndpoint="/integrations",this._websiteProperties=i,this.swoopOnly=!1,this.dt=a,this._loopInitialized=!1,this._articleId=null,this._eventLogger=o,this._swoopInserted=!1,this._swoopNpi=c,this._swoopWebsiteId=null,this._swoopCbCalled=!1,this._idl=null,this.dt.callbackAfterLhk=function(e){r._swoopNpi=e.encrypted,r.run()},this.idlPromise=new Promise(function(e){r.dt.callbackAfterLiveRamp=e})}return(0,a.default)(e,[{key:"setArticleId",value:function(e){this._articleId=e}},{key:"run",value:function(){var e=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._websiteProperties.get();case 2:if(this.website=e.sent,this.swoopOnly=this.website.switches.swoop.cbOnly,this.website.switches.swoop){e.next=6;break}return e.abrupt("return");case 6:if(this.website.switches.isUS){e.next=8;break}return e.abrupt("return");case 8:if(this._swoopNpi===c&&(this._swoopNpi=this.website.switches.swoop.swn||l),this._swoopWebsiteId=this.website.switches.swoop.swi,this.swoopOnly||this._swoopWebsiteId){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,this._liveRampIntegration();case 14:this._swoopNpi!==l?this._swoopCbOrAppend():this._loop();case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_liveRampIntegration",value:function(){var e=(0,o.default)(i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this.website.switches.mainCookie.idl)&&t.length){e.next=5;break}return e.next=4,this.idlPromise;case 4:t=e.sent;case 5:if(""!==t){e.next=7;break}return e.abrupt("return",!1);case 7:return this._idl=t,this._swoopCbOrAppend(),e.abrupt("return",!0);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_swoopCbOrAppend",value:function(){this.swoopOnly?this._swoopCb():this._swoopAppend()}},{key:"_getIdlOrNpi",value:function(){return this._idl&&""!==this._idl?this._idl:[c,l,h].includes(this._swoopNpi)?null:this._swoopNpi}},{key:"_loop",value:function(){var e=this;this._loopInitialized||(this._loopInitialized=setInterval(function(){e._integrationsApi(function(t,r){if(!t)if([c,l,h].includes(e._swoopNpi)){var n=r.body,i=n.detected,o=n.swn;i&&!o&&(e._swoopNpi=l),!i&&e.dt.detectionStarted&&(e._swoopNpi=h),e.dt.detectionStarted||(e._swoopNpi=l),i&&o&&(e._swoopNpi=o),e._swoopCbOrAppend(),e._swoopNpi!==l&&e._stopLoop()}else e._stopLoop()})},5e3))}},{key:"_stopLoop",value:function(){clearInterval(this._loopInitialized)}},{key:"_swoopCb",value:function(){var e=this._getIdlOrNpi();return!(this._swoopCbCalled||!e)&&(this._swoopCbCalled=!0,"function"==typeof window._npi_cb&&window._npi_cb(e))}},{key:"_swoopAppend",value:function(){var e=this._getIdlOrNpi();if(!e)return!1;if(e&&this._swoopWebsiteId&&!this._swoopInserted){var t=document.createElement("script");return t.src=this.swoopScriptUrl,t.id="swoop_sdk",t.dataset.domain=this._swoopWebsiteId,t.dataset.npi=e,document.getElementsByTagName("body")[0].appendChild(t),this._swoopInserted=!0,!0}return!1}},{key:"_integrationsApi",value:function(e){return u.default.get(this.apiUrl.sponsored+this.integrationsEndpoint).set("".concat(this.tag,"-widget-version"),this.version).withCredentials().end(e)}}]),e}();r.default=p},{"@babel/runtime/helpers/asyncToGenerator":3,"@babel/runtime/helpers/classCallCheck":4,"@babel/runtime/helpers/createClass":5,"@babel/runtime/helpers/interopRequireDefault":7,"@babel/runtime/regenerator":12,superagent:24}],54:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/helpers/defineProperty")),o=n(e("@babel/runtime/regenerator")),s=n(e("@babel/runtime/helpers/asyncToGenerator")),a=n(e("@babel/runtime/helpers/classCallCheck")),u=n(e("@babel/runtime/helpers/createClass")),c=n(e("url")),l=n(e("superagent")),h=e("trendmd-meta-extractor"),p=n(e("./RequestCache"));function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}var f=function(){function e(t){var r=t.config,n=t.options,i=t.websiteProperties;(0,a.default)(this,e),this.apiUrl=r.apiUrl,this.tag=r.tag,this.version=r.version,this.options=n,this.websiteProperties=i,this.website={},this.sponsoredRequestPromises={},this.nonSponsoredRequestPromises={},this.isExecuted=!1}return(0,u.default)(e,[{key:"run",value:function(){var e=(0,s.default)(o.default.mark(function e(){var t,r,n,i,s,a,u=this,c=arguments;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]&&c[0],!this.isExecuted){e.next=3;break}return e.abrupt("return");case 3:return this.isExecuted=!0,e.next=6,this.websiteProperties.get();case 6:if(this.website=e.sent,r=this.website,n=r.widgets,!r.hasJsInterface||t){e.next=11;break}return this.isExecuted=!1,e.abrupt("return");case 11:if(this.missingEndpoint="/journals/".concat(this.website.id,"/missing"),this.articlesEndpoint="/journals/".concat(this.website.id,"/articles"),this.extractor=new h.MetaExtractor(document,this.website),i=this.queryParams(),!this.isMissing(i)){e.next=18;break}return this.missing(),e.abrupt("return");case 18:this.createExecuted=!1,this.updateExecuted=!1,s={"Always load":0,NPI:0,IP:0,"NPI or IP":0},a=0,n.forEach(function(e){u.sponsoredRequestPromises[e.id]=new Promise(function(t,r){u._prepareSimilarArticlesRequest("sponsored",i,e,s[e.conditionalLoading],n.length,t,r)}),u.nonSponsoredRequestPromises[e.id]=new Promise(function(t,r){u._prepareSimilarArticlesRequest("nonsponsored",i,e,a,n.length,t,r)}),"both"===e.recommendationsType?(s[e.conditionalLoading]+=e.sponsoredLimit,a+=e.numberOfRecommendations-e.sponsoredLimit):"sponsored"===e.recommendationsType?s[e.conditionalLoading]+=e.numberOfRecommendations:a+=e.numberOfRecommendations});case 23:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getSponsored",value:function(){var e=(0,s.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sponsoredRequestPromises[t]);case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getNonSponsored",value:function(){var e=(0,s.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.nonSponsoredRequestPromises[t]);case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_prepareSimilarArticlesRequest",value:function(e,t,r,n,i,o,s){var a=this,u=Object.assign({},t,{offset:n,boostedRecommendationsLimit:r.boostedRecommendationsLimit,recommendationsType:r.recommendationsType,numberOfRecommendations:r.numberOfRecommendations,sponsoredLimit:r.sponsoredLimit,titleSize:r.titleSize,fontSize:r.fontSize,titleWording:r.titleWording,logoStyle:r.logoStyle,columns:r.columns,conditionalLoading:r.conditionalLoading},"nonsponsored"===e&&{timestamp:this.website.updatedAt},"sponsored"===e&&i>1&&{widgetId:r.widgetId,numberOfWidgets:i});this._fetchSimilarArticles({endpoint:"/journals/".concat(this.website.id,"/similar-").concat(e),params:this.website.findArticlesByUrlOnly?{url:u.url}:u,type:e},function(t,r){if(t&&t.timeout)o({timeout:!0});else{if(403!==r.status)return 404===r.status?(a.createExecuted||(a.createExecuted=!0,a.create()),void s({status:r.status,error:t})):void(r.status>=400||(r.type=e,o(r)));s({status:r.status,error:t})}})}},{key:"_fetchSimilarArticles",value:function(e,t){var r=e.endpoint,n=e.params,i="nonsponsored"===e.type?this.apiUrl.nonSponsored:this.apiUrl.sponsored;return l.default.get(i+r).set("".concat(this.tag,"-widget-version"),this.version).timeout(3e4).withCredentials().query(n).use(p.default).end(t)}},{key:"updateArticle",value:function(e){var t=this.extractor.abstract?this.extractor.abstract.trim().length:0,r=e.id,n=e.meta_dated,i=e.missing_meta,o=e.abstract;r&&n&&(i||o<t)&&this.update(r)}},{key:"create",value:function(e){l.default.post(this.apiUrl.sponsored+this.articlesEndpoint).set("".concat(this.tag,"-widget-version"),this.version).timeout(3e4).send(this.storeParams()).end(e)}},{key:"update",value:function(e,t){l.default.put("".concat(this.apiUrl.sponsored).concat(this.articlesEndpoint,"/").concat(e)).set("".concat(this.tag,"-widget-version"),this.version).send(this.storeParams()).end(t)}},{key:"missing",value:function(){this.nonMissingUrl()||l.default.post(this.apiUrl.sponsored+this.missingEndpoint).set("".concat(this.tag,"-widget-version"),this.version).timeout(3e4).send({url:this.options.url||window.location.href}).end()}},{key:"queryParams",value:function(){return this.params("pubmed_id","doi","title","authors","url","publication_year","publication_month")}},{key:"storeParams",value:function(){return this.params("staging","pubmed_id","doi","title","authors","url","publication_year","publication_month","publicationDates","abstract")}},{key:"params",value:function(){for(var e=this,t={},r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];if(n.includes("url")){var o=c.default.parse(window.location.href),s=o;this.options.url&&((s=c.default.parse(this.options.url)).protocol||(s.protocol=o.protocol),s.host||(s.host=o.host)),t.url=c.default.format(s)}return n.includes("staging")&&(t.staging=this.website.staging),n.forEach(function(r){"url"!==r&&"staging"!==r&&(t[r]=e.checkParam(r,e.options[r]||e.extractor[r]))}),t}},{key:"checkParam",value:function(e,t){if("publication_year"===e)return t>=1900&&t<=2100?t:null;if("publication_month"===e)return t>=1&&t<=12?t:null;if("publicationDates"===e){var r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach(function(t){(0,i.default)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},t);return Object.keys(t).forEach(function(e){(!t[e].year||t[e].year<1900||t[e].year>2100)&&(r[e].year=null),(!t[e].month||t[e].month<1||t[e].month>12)&&(r[e].month=null)}),r}return t}},{key:"isMissing",value:function(e){return this.missingParameters(e)}},{key:"missingParameters",value:function(e){return!e.title&&!e.doi&&!e.pubmed_id}},{key:"nonMissingUrl",value:function(){return this.fileUrl()||this.googleCacheUrl()}},{key:"fileUrl",value:function(){return(this.options.url||window.location.href).match(/^file:\/\//)}},{key:"googleCacheUrl",value:function(){return(this.options.url||window.location.href).match(/^http:\/\/webcache\.googleusercontent\.com\/search/)}}]),e}();r.default=f},{"./RequestCache":56,"@babel/runtime/helpers/asyncToGenerator":3,"@babel/runtime/helpers/classCallCheck":4,"@babel/runtime/helpers/createClass":5,"@babel/runtime/helpers/defineProperty":6,"@babel/runtime/helpers/interopRequireDefault":7,"@babel/runtime/regenerator":12,superagent:24,"trendmd-meta-extractor":31,url:45}],55:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/regenerator")),o=n(e("@babel/runtime/helpers/asyncToGenerator")),s=n(e("@babel/runtime/helpers/classCallCheck")),a=n(e("@babel/runtime/helpers/createClass")),u=function(){function e(t){var r=this;(0,s.default)(this,e),this.widgetsInfo={},t.forEach(function(e){var t=null,n=null,i=new Promise(function(e){t=e}),o=new Promise(function(e){n=e});r.widgetsInfo[e.widgetId]={numberOfRecommendations:e.numberOfRecommendations,recommendationsType:e.recommendationsType,sponsoredLimit:e.sponsoredLimit,recommendations:{sponsored:[],nonsponsored:[]},readyPromise:i,onReady:t,loadedPromise:o,onLoaded:n,responsesReceived:0,container:null}}),this.maxWidgetId=t.length-1}return(0,a.default)(e,[{key:"balanceRecommendations",value:function(){var e=(0,o.default)(i.default.mark(function e(t){var r,n,o,s,a,u,c,l,h,p,d,f;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.widgetsInfo[t],n=r.recommendations.sponsored.length,o=r.recommendations.nonsponsored.length,s=[],a=[],"sponsored"!==r.recommendationsType){e.next=12;break}return u=r.numberOfRecommendations-n,e.next=9,this.getExtraRecommendations(t,"sponsored",u);case 9:s=e.sent,e.next=28;break;case 12:if("nonsponsored"!==r.recommendationsType){e.next=19;break}return c=r.numberOfRecommendations-o,e.next=16,this.getExtraRecommendations(t,"nonsponsored",c);case 16:a=e.sent,e.next=28;break;case 19:return l=r.sponsoredLimit-n,h=r.numberOfRecommendations-r.sponsoredLimit-o,e.next=23,this.getExtraRecommendations(t,"sponsored",l);case 23:return s=e.sent,h+=l-s.length,e.next=27,this.getExtraRecommendations(t,"nonsponsored",h);case 27:a=e.sent;case 28:p=r.container.querySelectorAll("ol.trendmd-widget-list"),d=document.createDocumentFragment(),f=document.createDocumentFragment(),r.recommendations.sponsored.forEach(function(e){d.appendChild(e)}),s.forEach(function(e){d.appendChild(e)}),r.recommendations.nonsponsored.forEach(function(e){f.appendChild(e)}),a.forEach(function(e){f.appendChild(e)}),p.forEach(function(e,t){e.innerHTML="",0===t&&e.appendChild(f),t===p.length-1&&e.appendChild(d)}),r.onReady(r.container.innerHTML);case 37:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getExtraRecommendations",value:function(){var e=(0,o.default)(i.default.mark(function e(t,r,n){var s,a,u=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==n){e.next=2;break}return e.abrupt("return",[]);case 2:return s=function(){var e=(0,o.default)(i.default.mark(function e(t){var o,s;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t>u.maxWidgetId)){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,u.widgetsInfo[t].loadedPromise;case 4:return o=u.widgetsInfo[t].recommendations[r],s=[],o.length>0&&(s=o.slice(0,n),u.widgetsInfo[t].recommendations[r]=o.slice(n)),e.abrupt("return",s);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a=[],e.next=6,s(t+1);case 6:if(!((a=e.sent).length<n)){e.next=13;break}return e.t0=a,e.next=11,s(t+2);case 11:e.t1=e.sent,a=e.t0.concat.call(e.t0,e.t1);case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}},e)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"onRecommendationsReceived",value:function(e,t,r){var n=document.createElement("html"),i=this.widgetsInfo[e];n.innerHTML=t;var o=n.querySelectorAll("li.trendmd-widget-list-item");i.recommendations[r]=Array.from(o),i.responsesReceived+=1,null!==i.container&&"sponsored"!==r||(i.container=n),2===i.responsesReceived&&this.onLoaded(e)}},{key:"onLoaded",value:function(){var e=(0,o.default)(i.default.mark(function e(t){var r,n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(this.widgetsInfo[t].onLoaded(),r=[],n=0;n<t;n++)r.push(this.widgetsInfo[n].readyPromise);return e.next=5,Promise.all(r);case 5:this.balanceRecommendations(t);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onError",value:function(){var e=(0,o.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.widgetsInfo[t].onReady();case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getBalancedRecommendations",value:function(){var e=(0,o.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.widgetsInfo[t].readyPromise);case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();r.default=u},{"@babel/runtime/helpers/asyncToGenerator":3,"@babel/runtime/helpers/classCallCheck":4,"@babel/runtime/helpers/createClass":5,"@babel/runtime/helpers/interopRequireDefault":7,"@babel/runtime/regenerator":12}],56:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("cache-service-cache-module")),o=n(e("superagent-cache-plugin")),s=new i.default({storage:"",defaultExpiration:900,verbose:!1}),a=(0,o.default)(s);r.default=a},{"@babel/runtime/helpers/interopRequireDefault":7,"cache-service-cache-module":13,"superagent-cache-plugin":21}],57:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/helpers/classCallCheck")),o=n(e("@babel/runtime/helpers/createClass")),s=new(function(){function e(){(0,i.default)(this,e),this.times={}}return(0,o.default)(e,[{key:"init",value:function(){this.times.start||(this.times.start=new Date)}},{key:"log",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"start";this.times.start||console.error("TimeLogger: can't log ".concat(e,", logger isn't initilized yet")),this.times[e]=new Date-this.times[t]}}]),e}());r.default=s},{"@babel/runtime/helpers/classCallCheck":4,"@babel/runtime/helpers/createClass":5,"@babel/runtime/helpers/interopRequireDefault":7}],58:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/regenerator")),o=n(e("@babel/runtime/helpers/asyncToGenerator")),s=n(e("@babel/runtime/helpers/classCallCheck")),a=n(e("@babel/runtime/helpers/createClass")),u=n(e("superagent")),c=e("trendmd-meta-extractor"),l=n(e("./TimeLogger")),h=n(e("./RequestCache")),p=function(){function e(t){var r=t.apiUrl,n=t.options,i=t.version,o=t.tag;(0,s.default)(this,e),this.apiUrl=r,this.options=n,this.version=i,this.tag=o}return(0,a.default)(e,[{key:"get",value:function(){var e=(0,o.default)(i.default.mark(function e(){var t=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){if(!window.trendmdGlobalState.journal||t.options.displayWidgetOnDemand){var n,i;if(t.options.journal_id)n="/journals/".concat(t.options.journal_id,"/selectors"),i={};else{n="/journals/identification";var o=new c.MetaExtractor(window.document,{sources:["HighWire","DCSext","DublinCore","DCTerms","Prism","BEPress","EPrints","WolterKluwer","TandFonline"],tags:["doi","issn","journal_title","custom_id"]});i={doi:t.options.doi||o.doi,issn:t.options.issn||o.issn,url:t.options.url||window.location.href,custom_id:t.options.custom_id||o.custom_id}}u.default.get(t.apiUrl.sponsored+n).set("".concat(t.tag,"-widget-version"),t.version).withCredentials().query(i).use(h.default).end(function(t,i){"/journals/identification"===n?l.default.log("identification"):l.default.log("selectors"),t||i.error?r(t||i.error):(window.trendmdGlobalState.journal=i.body.journal,e(i.body.journal))})}else e(window.trendmdGlobalState.journal)}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),e}();r.default=p},{"./RequestCache":56,"./TimeLogger":57,"@babel/runtime/helpers/asyncToGenerator":3,"@babel/runtime/helpers/classCallCheck":4,"@babel/runtime/helpers/createClass":5,"@babel/runtime/helpers/interopRequireDefault":7,"@babel/runtime/regenerator":12,superagent:24,"trendmd-meta-extractor":31}],59:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/regenerator")),o=n(e("@babel/runtime/helpers/asyncToGenerator")),s=n(e("@babel/runtime/helpers/classCallCheck")),a=n(e("@babel/runtime/helpers/createClass")),u=n(e("./WidgetPosition")),c=n(e("./ArticleHeader")),l=function(){function e(t){var r=t.config,n=t.options,i=t.events,o=t.recommendations,a=t.instanceOptions,c=t.integrations,l=t.gdpr,h=t.recommendationsBalancer;(0,s.default)(this,e),this.tag=r.tag,this.widgetOptionsId=a.id,this.widgetId=a.widgetId,this.recommendations=o,this.events=i,this.recommendationsBalancer=h,this.integrations=c,this.position=new u.default({config:r,options:n,eventLogger:this.events._eventLogger,instanceOptions:a,gdpr:l})}return(0,a.default)(e,[{key:"init",value:function(){var e=(0,o.default)(i.default.mark(function e(){var t,r,n,s,a,u=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=window.trendmdGlobalState,r=t.journal,n=t.cache,s=r&&r.hasJsInterface,this.position.define(),!s){e.next=22;break}return e.prev=4,e.next=7,this.position.isDefinedPromise;case 7:e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(4),console.error("WidgetPosition error: ".concat(e.t0)),e.abrupt("return",Promise.reject());case 13:if(a=this.position._widgetPositionSelector,!n||!n[a]){e.next=20;break}return this.position.widgetPositionElement.innerHTML=n[a],this.position.onClick(function(e){return u.events.click(e)}),this.events.elements[this.widgetOptionsId]=this.position.widgetContainer,e.abrupt("return",Promise.resolve(this.widgetOptionsId));case 20:return e.next=22,this.recommendations.run(!0);case 22:return e.abrupt("return",Promise.race([this.recommendations.getSponsored(this.widgetOptionsId),this.recommendations.getNonSponsored(this.widgetOptionsId)]).then(function(){var e=(0,o.default)(i.default.mark(function e(t){var r,n,o,a,l,h,p,d,f;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.headers,n=t.text,o=t.type,!t.timeout){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("timeout")));case 3:return a=new c.default(r["".concat(u.tag,"-article")]),u.recommendations.updateArticle(a),u.events.testID=r["x-testid"],u.events.articleId=a.id,u.integrations.setArticleId(a.id),e.prev=8,e.next=11,u.position.isDefinedPromise;case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(8),console.error("WidgetPosition error: ".concat(e.t0)),e.abrupt("return",Promise.reject());case 17:return u.recommendationsBalancer.onRecommendationsReceived(u.widgetId,n,o),u.position.setFirstResponse({type:o,text:n}),l="sponsored"===o?u.recommendations.getNonSponsored(u.widgetOptionsId):u.recommendations.getSponsored(u.widgetOptionsId),e.next=22,l;case 22:return p=e.sent,u.recommendationsBalancer.onRecommendationsReceived(u.widgetId,p.text||"",p.type),e.prev=24,e.next=27,u.recommendationsBalancer.getBalancedRecommendations(u.widgetId);case 27:h=e.sent,e.next=34;break;case 30:return e.prev=30,e.t1=e.catch(24),console.error("WidgetPosition error: ".concat(e.t1)),e.abrupt("return",Promise.reject());case 34:if(u.position.sponsoredPoolIsNotEmpty=u.recommendationsBalancer.widgetsInfo[u.widgetId].recommendations.sponsored.length>0,u.position.setSecondResponse(Object.assign({},p,{text:h})),s&&(d=u.position._widgetPositionSelector,f=u.position.widgetPositionElement,window.trendmdGlobalState.cache[d]=f.innerHTML),u.position.onClick(function(e){return u.events.click(e)}),u.events.elements[u.widgetOptionsId]=u.position.widgetContainer,!p.timeout){e.next=41;break}return e.abrupt("return",Promise.reject(new Error("timeout")));case 41:return e.abrupt("return",Promise.resolve(u.widgetOptionsId));case 42:case"end":return e.stop()}},e,null,[[8,13],[24,30]])}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){if(u.recommendationsBalancer.onError(u.widgetId),e){var t=e.error;return Promise.reject(t)}return Promise.reject(e)}));case 23:case"end":return e.stop()}},e,this,[[4,9]])}));return function(){return e.apply(this,arguments)}}()}]),e}();r.default=l},{"./ArticleHeader":47,"./WidgetPosition":61,"@babel/runtime/helpers/asyncToGenerator":3,"@babel/runtime/helpers/classCallCheck":4,"@babel/runtime/helpers/createClass":5,"@babel/runtime/helpers/interopRequireDefault":7,"@babel/runtime/regenerator":12}],60:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/regenerator")),o=n(e("@babel/runtime/helpers/asyncToGenerator")),s=n(e("@babel/runtime/helpers/classCallCheck")),a=n(e("@babel/runtime/helpers/createClass")),u=n(e("./Widget")),c=n(e("./RecommendationsBalancer")),l=function(){function e(t){var r=t.config,n=t.options,i=t.websiteProperties,o=t.events,a=t.recommendations,u=t.integrations,c=t.gdpr;(0,s.default)(this,e),this.config=r,this.options=n,this.websiteProperties=i,this.events=o,this.recommendations=a,this.integrations=u,this.gdpr=c,this.instancesOptions=[],this.instances=[]}return(0,a.default)(e,[{key:"init",value:function(){var e=(0,o.default)(i.default.mark(function e(){var t,r,n,o,s,a=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.recommendations.isExecuted){e.next=3;break}return e.next=3,this.recommendations.run();case 3:return e.prev=3,e.next=6,this.websiteProperties.get();case 6:t=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),console.error("WebsiteProperties error: ".concat(e.t0)),e.abrupt("return");case 13:return this.events.journalId=t.id,this.events.contentCategory=t.category,this.events.switches=t.switches||{},this.gdpr.journalId=t.id,this.gdpr.switches=t.switches||{},r=new c.default(t.widgets),n=t.widgets.map(function(e){var n=Object.assign({},e,{websiteId:t.id,switches:t.switches,hideWidget:t.hideExtraWidgets}),i=new u.default({config:a.config,options:a.options,events:a.events,recommendations:a.recommendations,instanceOptions:n,integrations:a.integrations,gdpr:a.gdpr,recommendationsBalancer:r});return a.instances.push(i),a.instancesOptions.push(n),i.init()}),e.next=22,Promise.all(n.map(function(e){return e.catch(function(){return!1})})).then(function(e){return e.filter(function(e){return!1!==e})});case 22:o=e.sent,s=t.widgets.filter(function(e){return o.includes(e.id)}).reduce(function(e,t){return e+t.numberOfRecommendations},0),this.gdpr.widgetIsLoaded&&this.gdpr.addGaTrackingCode(),this.events.impression(o,s);case 26:case"end":return e.stop()}},e,this,[[3,9]])}));return function(){return e.apply(this,arguments)}}()}]),e}();r.default=l},{"./RecommendationsBalancer":55,"./Widget":59,"@babel/runtime/helpers/asyncToGenerator":3,"@babel/runtime/helpers/classCallCheck":4,"@babel/runtime/helpers/createClass":5,"@babel/runtime/helpers/interopRequireDefault":7,"@babel/runtime/regenerator":12}],61:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/helpers/slicedToArray")),o=n(e("@babel/runtime/helpers/classCallCheck")),s=n(e("@babel/runtime/helpers/createClass")),a=n(e("domready")),u=n(e("superagent")),c=n(e("./TimeLogger"));a.default.domready=a.default;var l=function(){function e(t){var r=t.config,n=t.options,i=t.instanceOptions,s=t.eventLogger,a=t.gdpr;(0,o.default)(this,e);var u=i.selectors,c=i.placementSelector,l=i.placementPosition,h=i.wrapperStart,p=i.wrapperEnd,d=i.numberOfRecommendations,f=i.conditionalLoading;this.numberOfRecommendations=d,this.mainWidget=0===i.widgetId,this.widgetId=i.widgetId,this.styleSheetUrl=r.styleSheetUrl,this.selectors=u,this.placementSelector=c,this.placementPosition=l,this.widgetWrapperStart=h,this.widgetWrapperEnd=p,this.options=n,this.config=r,this.gdpr=a,this.responsesTracked=0,this.sponsoredPoolIsNotEmpty=!1,this.conditionalLoading=(f||"Always load").toLowerCase(),this.widgetIsInIframe=function(){try{return window.self!==window.top}catch(e){return!0}}(),this._widgetPositionSelector=null,this._widgetContainerSelector=".".concat(this.config.tag,"-widget-container"),this._dedicatedContainerSelector=this._widgetContainerSelector,this._adBlockCheckingContainerId="".concat(this.config.tag,"-check"),this._journalId=i.id,this._switches=i.switches||{},this._eventLogger=s,this.postResponseCb=function(){return null},this.isDefinedPromise=null}return(0,s.default)(e,[{key:"dataset",get:function(){return this.element.querySelector(this._dedicatedContainerSelector).dataset}},{key:"widgetContainer",get:function(){return this.element.querySelector(this._dedicatedContainerSelector)}},{key:"widgetPositionElement",get:function(){return document.querySelector(this._widgetPositionSelector)}},{key:"define",value:function(){var e=this;this.isDefinedPromise=new Promise(function(t,r){a.default.domready(function(){c.default.log("domReady");var n=function(e){return e.replace(/#(\d)/g,"#\\3$1 ")},i=document.querySelector(e.options.element),o=e.placementSelector?document.querySelector(n(e.placementSelector)):null,s=!1;if(e._widgetPositionSelector=e.options.element,o){var a=window.getComputedStyle(o);s="hidden"!==a.getPropertyValue("visibility")&&"none"!==a.getPropertyValue("display")}o&&s?(e.element=o,e.insertPosition=e.placementPosition||null,e.wrapperStart=e.widgetWrapperStart||"",e.wrapperEnd=e.widgetWrapperEnd||"",e._widgetPositionSelector=n(e.placementSelector)):e.mainWidget&&(e.element=i),e.element?(e.addStyle(),"function"==typeof e.options.cbRetrieve&&e.options.cbRetrieve(),t("OK")):r(new Error("No element"))})})}},{key:"afterFirstResponse",value:function(){var e=this;this.postResponseCb=function(){c.default.log("recos"),c.default.log("timeToClickStart"),e.checkAdBlock(),e.gdpr.widgetIsLoaded=!0,e._switches.isUS&&Array.prototype.forEach.call(document.querySelectorAll(".trendmd-widget-dns"),function(e){e.style.display="block"}),"function"==typeof e.options.cb&&e.options.cb()}}},{key:"setFirstResponse",value:function(e){var t=e.type,r=e.text,n=this.wrapResponsedText(r);this.insertPosition&&"replace"!==this.insertPosition?this.element.insertAdjacentHTML(this.insertPosition,n):this.element.innerHTML=n;var i=this.element.querySelector(this._widgetContainerSelector);i.setAttribute("similar-".concat(t,"-merged"),!0),i.setAttribute("style","display: none;"),i.dataset["".concat(this.config.tag,"WidgetId")]=this.widgetId,this._dedicatedContainerSelector="".concat(this._widgetContainerSelector,'[data-trendmd-widget-id="').concat(this.widgetId,'"]'),this.trackResponse(),this.afterFirstResponse()}},{key:"showWidget",value:function(){this.element.querySelector(this._dedicatedContainerSelector).setAttribute("style","display: block;")}},{key:"setSecondResponse",value:function(e){var t=e.type,r=e.text;if(r&&r.length){var n=document.createElement("html");n.innerHTML=r;var i=n.querySelectorAll("li.trendmd-widget-list-item").length,o=this.numberOfRecommendations>i,s="always load"===this.conditionalLoading&&(this.mainWidget&&i>0||!o),a="always load"!==this.conditionalLoading&&this.sponsoredPoolIsNotEmpty;(s||a)&&(this.mergeSecondaryResponse(r,t),this.balanceListing(),this.showWidget())}this.trackResponse(),this.postResponseCb()}},{key:"mergeSecondaryResponse",value:function(e,t){var r=this.element.querySelector(this._dedicatedContainerSelector),n=r.querySelectorAll("ol.trendmd-widget-list"),i=document.createElement("html");if(r.setAttribute("similar-".concat(t,"-merged"),!0),i.innerHTML=e,"sponsored"===t){var o=i.querySelector("div.trendmd-widget-footer-inner"),s=r.querySelector("div.trendmd-widget-footer");s.innerHTML="",s.appendChild(o)}Array.prototype.forEach.call(i.querySelectorAll("ol.trendmd-widget-list"),function(e,t){n[t].innerHTML=e.innerHTML});var a=r.querySelector('a[href*="/logout"');if(a&&(a.onclick=function(e){e.preventDefault(),u.default.get(a.href).withCredentials().end(function(e,t){200===t.status&&location.reload()})}),"sponsored"===t){var c=i.querySelector(this._widgetContainerSelector);Object.keys(c.dataset).forEach(function(e){r.dataset[e]=c.dataset[e]})}}},{key:"balanceListing",value:function(){var e=this.element.querySelector(this._dedicatedContainerSelector).querySelectorAll("ol.trendmd-widget-list"),t=(0,i.default)(e,2),r=t[0],n=t[1];if(r&&n)for(var o=6,s=-(r.children.length+n.children.length)%2;n.children.length-r.children.length!==s;){if(n.children.length-r.children.length>s){var a=n.removeChild(n.children[0]);r.appendChild(a)}if(n.children.length-r.children.length<s){var u=r.removeChild(r.children[r.children.length-1]);n.insertBefore(u,n.children[0])}if(!(o-=1))return}}},{key:"trackResponse",value:function(){this.responsesTracked+=1,2===this.responsesTracked&&this.widgetIsInIframe&&window.parent.postMessage({linksLoaded:document.getElementsByClassName("trendmd-widget-list-item__link").length,sender:"trendmd"},"*")}},{key:"onClick",value:function(e){this.element.querySelector(this._dedicatedContainerSelector).onclick=function(t){"A"===t.target.tagName&&e(t.target)},this.element.querySelector(this._dedicatedContainerSelector).onauxclick=function(t){"A"===t.target.tagName&&1===t.button&&e(t.target)}}},{key:"wrapResponsedText",value:function(e){var t="string"==typeof this.wrapperStart?this.wrapperStart:"",r="string"==typeof this.wrapperEnd?this.wrapperEnd:"";return t+e.replace(/Pending(<span.*?),\s/gm,"$1")+r}},{key:"addStyle",value:function(){var e=document.querySelector('link[rel="stylesheet"][href="'.concat(this.styleSheetUrl,'"]'));if(e)return e;var t=document.createElement("link");return t.rel="stylesheet",t.type="text/css",t.href=this.styleSheetUrl,t.media="all",document.getElementsByTagName("head")[0].appendChild(t)}},{key:"checkAdBlock",value:function(){var e=document.getElementById(this._adBlockCheckingContainerId);if(e){var t,r=e.querySelector("#".concat("ad-holder"));if(r)t="none"===window.getComputedStyle(r).display;else t=!0;this._eventLogger.hasAdBlock=t}}}]),e}();r.default=l},{"./TimeLogger":57,"@babel/runtime/helpers/classCallCheck":4,"@babel/runtime/helpers/createClass":5,"@babel/runtime/helpers/interopRequireDefault":7,"@babel/runtime/helpers/slicedToArray":10,domready:15,superagent:24}],62:[function(e,t,r){(function(t){(function(){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.TrendMD=r.config=void 0;var i=n(e("../Initializer")),o=n(e("../../../version")),s={tag:"trendmd",apiUrl:{sponsored:"undefined"!=typeof RSEnvEndpoint&&RSEnvEndpoint||"https://www.trendmd.com",nonSponsored:"undefined"!=typeof RSEnvEndpoint&&RSEnvEndpoint||"https://cc.trendmd.co"},relevancyUrl:"undefined"!=typeof CollectorEnvEndpoint&&CollectorEnvEndpoint||"https://academia.trendmd.com",swoopScriptUrl:"undefined"!=typeof SwoopScriptUrl&&SwoopScriptUrl||"https://ardrone.swoop.com/js/spxw.js",styleSheetUrl:"https://css.trendmd.com/trendmd.min.css",dtConfig:{liveRamp:{api:"undefined"!=typeof LiveRampUrl&&LiveRampUrl||"https://api.rlcdn.com/api/identity/idl"},dmd:{origin:"https://www.medtargetsystem.com",path:"/beacon/portal-lite"},lhk:{api:"https://flowtype.press"}},version:o.default};r.config=s;var a=i.default;r.TrendMD=a,t.TrendMD=new a(s)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../version":63,"../Initializer":52,"@babel/runtime/helpers/interopRequireDefault":7}],63:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;r.default="3.8.3"},{}]},{},[62]);